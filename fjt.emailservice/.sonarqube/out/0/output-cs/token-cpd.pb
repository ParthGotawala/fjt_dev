°
DD:\Development\FJT\FJT-DEV\fjt.emailservice\App_Start\UnityConfig.cs
	namespace 	
fjt
 
. 
emailservice 
{ 
public 

static 
class 
UnityConfig #
{ 
private 
static 
Lazy 
< 
IUnityContainer +
>+ ,
	container- 6
=7 8
new
 
Lazy 
< 
IUnityContainer "
>" #
(# $
($ %
)% &
=>' )
{
 
var 
	container 
= 
new !
UnityContainer" 0
(0 1
)1 2
;2 3
RegisterTypes 
( 
	container %
)% &
;& '
return 
	container 
; 
}
 
) 
; 
public   
static   
IUnityContainer   %
	Container  & /
=>  0 2
	container  3 <
.  < =
Value  = B
;  B C
public-- 
static-- 
void-- 
RegisterTypes-- (
(--( )
IUnityContainer--) 8
	container--9 B
)--B C
{.. 	
	container66 
.66 
RegisterTypes66 #
(66# $

AllClasses66$ .
.66. /
FromAssemblies66/ =
(66= >
Assembly77 
.77 
GetAssembly77 "
(77" #
typeof77# )
(77) *#
IEmailApiRequestHandler77* A
)77A B
)77B C
)88 
,88 
WithMappings88  
.88  !!
FromMatchingInterface88! 6
,886 7
WithName888 @
.88@ A
Default88A H
,88H I
WithLifetime88J V
.88V W
	PerThread88W `
)88` a
;88a b
	container99 
.99 
RegisterType99 "
<99" #
ICommonApiEmail99# 2
,992 3
MailgunEmailRequest994 G
>99G H
(99H I
EmailAPINames99I V
.99V W
Mailgun99W ^
.99^ _
ToString99_ g
(99g h
)99h i
)99i j
;99j k
	container:: 
.:: 
RegisterType:: "
<::" #
ICommonApiEmail::# 2
,::2 3
SmtpEmailRequest::4 D
>::D E
(::E F
EmailAPINames::F S
.::S T
Smtp::T X
.::X Y
ToString::Y a
(::a b
)::b c
)::c d
;::d e
	container;; 
.;; 
RegisterType;; "
<;;" #
	IErrorLog;;# ,
,;;, -
ErrorLog;;. 6
>;;6 7
(;;7 8
);;8 9
;;;9 :
}<< 	
}== 
}>> Ì
JD:\Development\FJT\FJT-DEV\fjt.emailservice\App_Start\UnityMvcActivator.cs
[ 
assembly 	
:	 

WebActivatorEx 
. %
PreApplicationStartMethod 3
(3 4
typeof4 :
(: ;
fjt; >
.> ?
emailservice? K
.K L
UnityMvcActivatorL ]
)] ^
,^ _
nameof` f
(f g
fjtg j
.j k
emailservicek w
.w x
UnityMvcActivator	x â
.
â ä
Start
ä è
)
è ê
)
ê ë
]
ë í
[ 
assembly 	
:	 

WebActivatorEx 
. %
ApplicationShutdownMethod 3
(3 4
typeof4 :
(: ;
fjt; >
.> ?
emailservice? K
.K L
UnityMvcActivatorL ]
)] ^
,^ _
nameof` f
(f g
fjtg j
.j k
emailservicek w
.w x
UnityMvcActivator	x â
.
â ä
Shutdown
ä í
)
í ì
)
ì î
]
î ï
	namespace		 	
fjt		
 
.		 
emailservice		 
{

 
public 

static 
class 
UnityMvcActivator )
{ 
public 
static 
void 
Start  
(  !
)! "
{ 	
FilterProviders 
. 
	Providers %
.% &
Remove& ,
(, -
FilterProviders- <
.< =
	Providers= F
.F G
OfTypeG M
<M N)
FilterAttributeFilterProviderN k
>k l
(l m
)m n
.n o
Firsto t
(t u
)u v
)v w
;w x
FilterProviders 
. 
	Providers %
.% &
Add& )
() *
new* -.
"UnityFilterAttributeFilterProvider. P
(P Q
UnityConfigQ \
.\ ]
	Container] f
)f g
)g h
;h i
DependencyResolver 
. 
SetResolver *
(* +
new+ .#
UnityDependencyResolver/ F
(F G
UnityConfigG R
.R S
	ContainerS \
)\ ]
)] ^
;^ _
} 	
public!! 
static!! 
void!! 
Shutdown!! #
(!!# $
)!!$ %
{"" 	
UnityConfig## 
.## 
	Container## !
.##! "
Dispose##" )
(##) *
)##* +
;##+ ,
}$$ 	
}%% 
}&& Ï
PD:\Development\FJT\FJT-DEV\fjt.emailservice\BOEmail\Interface\ICommonApiEmail.cs
	namespace 	
fjt
 
. 
emailservice 
. 
BOEmail "
." #
	Interface# ,
{		 
public

 

	interface

 
ICommonApiEmail

 $
{ 
bool 
	SendEmail 
( 

EmailModel !
model" '
)' (
;( )
} 
} ë?
RD:\Development\FJT\FJT-DEV\fjt.emailservice\BOEmail\Mailgun\MailgunEmailRequest.cs
	namespace

 	
fjt


 
.

 
emailservice

 
.

 
BOEmail

 "
.

" #
Mailgun

# *
{ 
public 

class 
MailgunEmailRequest $
:% &
ICommonApiEmail' 6
{ 
public 
static 
string 
MailgunApiUrl *
=+ ,#
WebConfigurationManager- D
.D E
AppSettingsE P
[P Q
$strQ `
]` a
.a b
ToStringb j
(j k
)k l
;l m
public 
static 
string 

Mailgunkey '
=( )#
WebConfigurationManager* A
.A B
AppSettingsB M
[M N
$strN Z
]Z [
.[ \
ToString\ d
(d e
)e f
;f g
public 
static 
string 
MailgunDomainName .
=/ 0#
WebConfigurationManager1 H
.H I
AppSettingsI T
[T U
$strU h
]h i
.i j
ToStringj r
(r s
)s t
;t u
public 
static 
string 
FromMailForAdmin -
=. /#
WebConfigurationManager0 G
.G H
AppSettingsH S
[S T
$strT ^
]^ _
._ `
ToString` h
(h i
)i j
;j k
private 
readonly 
	IErrorLog "

_IErrorLog# -
;- .
public 
MailgunEmailRequest "
(" #
	IErrorLog# ,
	IErrorLog- 6
)6 7
{ 	

_IErrorLog 
= 
	IErrorLog "
;" #
} 	
public 
bool 
	SendEmail 
( 

EmailModel (
model) .
). /
{ 	
try 
{ 
if 
( 
model 
== 
null !
||" $
model% *
.* +
To+ -
==- /
null/ 3
||4 6
model7 <
.< =
To= ?
.? @
Length@ F
==G I
$numJ K
)K L
{ 
return 
false  
;  !
} 

RestClient   
client   !
=  " #
new  $ '

RestClient  ( 2
(  2 3
MailgunApiUrl  3 @
)  @ A
;  A B
client!! 
.!! 
Authenticator!! $
=!!% &
new!!' *"
HttpBasicAuthenticator!!+ A
(!!A B
$str!!B G
,!!G H

Mailgunkey!!I S
)!!S T
;!!T U
RestRequest"" 
request"" #
=""$ %
new""& )
RestRequest""* 5
(""5 6
)""6 7
;""7 8
request## 
.## 
AddParameter## $
(##$ %
$str##% -
,##- .
MailgunDomainName##/ @
,##@ A
ParameterType##B O
.##O P

UrlSegment##P Z
)##Z [
;##[ \
request$$ 
.$$ 
Resource$$  
=$$! "
$str$$# 6
;$$6 7
request%% 
.%% 
AddParameter%% $
(%%$ %
$str%%% +
,%%+ ,
FromMailForAdmin%%- =
)%%= >
;%%> ?
if&& 
(&& 
model&& 
.&& 
attachmentDetail&& *
!=&&+ -
null&&. 2
&&&&3 5
model&&6 ;
.&&; <
attachmentDetail&&< L
.&&L M
Count&&M R
>&&S T
$num&&U V
)&&V W
{'' 
foreach(( 
((( 
var((  
item((! %
in((& (
model(() .
.((. /
attachmentDetail((/ ?
)((? @
{)) 
if** 
(** 
!** 
string** #
.**# $
IsNullOrEmpty**$ 1
(**1 2
item**2 6
.**6 7
AttachmentName**7 E
)**E F
)**F G
request++ #
.++# $
AddFile++$ +
(+++ ,
$str++, 8
,++8 9
item++: >
.++> ?
BackupAttachment++? O
.++O P
ToArray++P W
(++W X
)++X Y
,++Y Z
item++[ _
.++_ `
AttachmentName++` n
)++n o
;++o p
},, 
}-- 
foreach// 
(// 
var// 
item// !
in//" $
model//% *
.//* +
To//+ -
.//- .
Split//. 3
(//3 4
$char//4 7
)//7 8
)//8 9
{00 
request11 
.11 
AddParameter11 (
(11( )
$str11) -
,11- .
item11/ 3
)113 4
;114 5
}22 
if44 
(44 
model44 
.44 
CC44 
!=44 
null44  $
&&44% '
model44( -
.44- .
CC44. 0
.440 1
Length441 7
>448 9
$num44: ;
)44; <
{55 
foreach66 
(66 
var66  
item66! %
in66& (
(66) *
model66* /
.66/ 0
CC660 2
.662 3
Split663 8
(668 9
$char669 <
)66< =
)66= >
)66> ?
{77 
request88 
.88  
AddParameter88  ,
(88, -
$str88- 1
,881 2
item883 7
)887 8
;888 9
}99 
}:: 
if<< 
(<< 
model<< 
.<< 
BCC<< 
!=<<  
null<<! %
&&<<& (
model<<) .
.<<. /
BCC<</ 2
.<<2 3
Length<<3 9
><<: ;
$num<<< =
)<<= >
{== 
foreach>> 
(>> 
var>>  
item>>! %
in>>& (
(>>) *
model>>* /
.>>/ 0
BCC>>0 3
.>>3 4
Split>>4 9
(>>9 :
$char>>: =
)>>= >
)>>> ?
)>>? @
{?? 
request@@ 
.@@  
AddParameter@@  ,
(@@, -
$str@@- 2
,@@2 3
item@@4 8
)@@8 9
;@@9 :
}AA 
}BB 
requestCC 
.CC 
AddParameterCC $
(CC$ %
$strCC% .
,CC. /
modelCC0 5
.CC5 6
SubjectCC6 =
)CC= >
;CC> ?
requestDD 
.DD 
AddParameterDD $
(DD$ %
$strDD% +
,DD+ ,
modelDD- 2
.DD2 3
BodyDD3 7
)DD7 8
;DD8 9
requestEE 
.EE 
MethodEE 
=EE  
MethodEE! '
.EE' (
POSTEE( ,
;EE, -
clientFF 
.FF 
ExecuteFF 
(FF 
requestFF &
)FF& '
;FF' (
}GG 
catchHH 
(HH 
	ExceptionHH 
exHH 
)HH  
{II 

ServiceLogJJ 
objModelJJ #
=JJ$ %
newJJ& )

ServiceLogJJ* 4
(JJ4 5
)JJ5 6
{KK 
errorLL 
=LL 
exLL 
.LL 
MessageLL &
,LL& '

stackTraceMM 
=MM  
exMM! #
.MM# $

StackTraceMM$ .
,MM. /
SourceNN 
=NN 
$strNN $
}OO 
;OO 

_IErrorLogPP 
.PP 
sendErrorQueuePP )
(PP) *
objModelPP* 2
)PP2 3
;PP3 4
}QQ 
returnRR 
trueRR 
;RR 
}SS 	
}TT 
}UU ´.
LD:\Development\FJT\FJT-DEV\fjt.emailservice\BOEmail\Smtp\SmtpEmailRequest.cs
	namespace 	
fjt
 
. 
emailservice 
. 
BOEmail "
." #
Smtp# '
{ 
public 

class 
SmtpEmailRequest !
:" #
ICommonApiEmail$ 3
{ 
public 
static 
string 
FromMail %
=& '#
WebConfigurationManager( ?
.? @
AppSettings@ K
[K L
$strL V
]V W
.W X
ToStringX `
(` a
)a b
;b c
public 
static 
string 
FromMailPassword -
=. /#
WebConfigurationManager0 G
.G H
AppSettingsH S
[S T
$strT f
]f g
.g h
ToStringh p
(p q
)q r
;r s
public 
static 
string 
SMTPHost %
=& '#
WebConfigurationManager( ?
.? @
AppSettings@ K
[K L
$strL V
]V W
.W X
ToStringX `
(` a
)a b
;b c
public 
static 
int 
SMTPPort "
=# $
Convert% ,
., -
ToInt32- 4
(4 5#
WebConfigurationManager5 L
.L M
AppSettingsM X
[X Y
$strY c
]c d
)d e
;e f
public 
bool 
	SendEmail 
( 

EmailModel (
model) .
). /
{ 	
if 
( 
model 
== 
null 
||  
model! &
.& '
To' )
.) *
Length* 0
==1 3
$num4 5
)5 6
{ 
return 
false 
; 
} 

SmtpClient 
client 
= 
new  #

SmtpClient$ .
(. /
)/ 0
;0 1
client 
. 
Host 
= 
SMTPHost "
;" #
client 
. 
Port 
= 
SMTPPort "
;" #
MailMessage 
message 
=  !
new" %
MailMessage& 1
(1 2
)2 3
;3 4
message 
. 
From 
= 
new 
MailAddress *
(* +
FromMail+ 3
)3 4
;4 5
foreach 
( 
var 
	toaddress "
in# %
(& '
model' ,
., -
To- /
./ 0
Split0 5
(5 6
$char6 9
)9 :
): ;
); <
{   
message!! 
.!! 
To!! 
.!! 
Add!! 
(!! 
new!! "
MailAddress!!# .
(!!. /
	toaddress!!/ 8
)!!8 9
)!!9 :
;!!: ;
}"" 
if## 
(## 
model## 
.## 
CC## 
!=## 
null##  
&&##! #
model##$ )
.##) *
CC##* ,
.##, -
Length##- 3
>##4 5
$num##6 7
)##7 8
{$$ 
foreach%% 
(%% 
var%% 
	ccaddress%% &
in%%' )
(%%* +
model%%+ 0
.%%0 1
CC%%1 3
.%%3 4
Split%%4 9
(%%9 :
$char%%: =
)%%= >
)%%> ?
)%%? @
{&& 
message'' 
.'' 
CC'' 
.'' 
Add'' "
(''" #
new''# &
MailAddress''' 2
(''2 3
	ccaddress''3 <
)''< =
)''= >
;''> ?
}(( 
})) 
if++ 
(++ 
model++ 
.++ 
BCC++ 
!=++ 
null++ !
&&++" $
model++% *
.++* +
BCC+++ .
.++. /
Length++/ 5
>++6 7
$num++8 9
)++9 :
{,, 
foreach-- 
(-- 
var-- 

bccaddress-- '
in--( *
(--+ ,
model--, 1
.--1 2
BCC--2 5
.--5 6
Split--6 ;
(--; <
$char--< ?
)--? @
)--@ A
)--A B
{.. 
message// 
.// 
Bcc// 
.//  
Add//  #
(//# $
new//$ '
MailAddress//( 3
(//3 4

bccaddress//4 >
)//> ?
)//? @
;//@ A
}00 
}11 
message33 
.33 
Subject33 
=33 
model33 #
.33# $
Subject33$ +
;33+ ,
message44 
.44 
Body44 
=44 
model44  
.44  !
Body44! %
;44% &
message55 
.55 

IsBodyHtml55 
=55  
true55! %
;55% &
client66 
.66 
Credentials66 
=66  
new66! $
System66% +
.66+ ,
Net66, /
.66/ 0
NetworkCredential660 A
(66A B
FromMail66B J
,66J K
FromMailPassword66L \
)66\ ]
;66] ^
client77 
.77 
	EnableSsl77 
=77 
true77 #
;77# $
client88 
.88 
Send88 
(88 
message88 
)88  
;88  !
return99 
true99 
;99 
}:: 	
};; 
}<< ê
<D:\Development\FJT\FJT-DEV\fjt.emailservice\EmailServices.cs
	namespace 	
fjt
 
. 
emailservice 
{ 
public 

partial 
class 
EmailServices &
:' (
ServiceBase) 4
{ 
public 
EmailServices 
( 
) 
{ 	
InitializeComponent 
(  
)  !
;! "
} 	
public 
void 
Start 
( 
string  
[  !
]! "
args# '
)' (
{ 	
OnStart 
( 
args 
) 
; 
} 	
	protected 
override 
void 
OnStart  '
(' (
string( .
[. /
]/ 0
args1 5
)5 6
{ 	
try 
{ #
IEmailApiRequestHandler   ' 
emailConsumerHandler  ( <
=  = >
UnityConfig  ? J
.  J K
	Container  K T
.  T U
Resolve  U \
<  \ ]#
IEmailApiRequestHandler  ] t
>  t u
(  u v
)  v w
;  w x 
emailConsumerHandler!! $
.!!$ %
Process!!% ,
(!!, -
)!!- .
;!!. /
}"" 
catch## 
(## 
	Exception## 
ex## 
)##  
{$$ 
}&& 
}'' 	
	protected)) 
override)) 
void)) 
OnStop))  &
())& '
)))' (
{** 	
base++ 
.++ 
OnStop++ 
(++ 
)++ 
;++ 
},, 	
}-- 
}..  @
ND:\Development\FJT\FJT-DEV\fjt.emailservice\Handlers\EmailApiRequestHandler.cs
	namespace 	
fjt
 
. 
emailservice 
. 
Handlers #
{ 
public 

class "
EmailApiRequestHandler '
:( )#
IEmailApiRequestHandler* A
{ 
IModel 
channel 
= 
null 
; 
public 
static 
IConnection !

connection" ,
=- .
null/ 3
;3 4
string 
emailServiceQueue  
=! " 
ConfigurationManager# 7
.7 8
AppSettings8 C
[C D
$strD V
]V W
.W X
ToStringX `
(` a
)a b
;b c
ushort &
EmailConsumerPrefetchCount )
=* +
ushort, 2
.2 3
Parse3 8
(8 9 
ConfigurationManager9 M
.M N
AppSettingsN Y
[Y Z
$strZ v
]v w
.w x
ToString	x Ä
(
Ä Å
)
Å Ç
)
Ç É
;
É Ñ
	IErrorLog 

_IErrorLog 
= 
UnityConfig *
.* +
	Container+ 4
.4 5
Resolve5 <
<< =
	IErrorLog= F
>F G
(G H
)H I
;I J
string 
rabbitMqURI 
=  
ConfigurationManager 1
.1 2
AppSettings2 =
[= >
$str> K
]K L
.L M
ToStringM U
(U V
)V W
;W X
public 
void 
Process 
( 
) 
{ 	
try 
{ 
ConnectionFactory !
factory" )
=* +
new, /
ConnectionFactory0 A
(A B
)B C
;C D
factory 
. $
AutomaticRecoveryEnabled 0
=1 2
true3 7
;7 8
factory 
. 
Uri 
= 
new !
Uri" %
(% &
rabbitMqURI& 1
)1 2
;2 3
factory   
.   
UserName    
=  ! " 
ConfigurationManager  # 7
.  7 8
AppSettings  8 C
[  C D
$str  D V
]  V W
;  W X
factory!! 
.!! 
Password!!  
=!!! " 
ConfigurationManager!!# 7
.!!7 8
AppSettings!!8 C
[!!C D
$str!!D V
]!!V W
;!!W X
factory"" 
."" 
VirtualHost"" #
=""$ % 
ConfigurationManager""& :
."": ;
AppSettings""; F
[""F G
$str""G a
]""a b
;""b c
factory## 
.## 
HostName##  
=##! " 
ConfigurationManager### 7
.##7 8
AppSettings##8 C
[##C D
$str##D W
]##W X
;##X Y

connection$$ 
=$$ 
factory$$ $
.$$$ %
CreateConnection$$% 5
($$5 6
)$$6 7
;$$7 8
using(( 
((( 
channel(( 
=((  

connection((! +
.((+ ,
CreateModel((, 7
(((7 8
)((8 9
)((9 :
{)) 
channel** 
.** 
QueueDeclare** (
(**( )
emailServiceQueue**) :
,**: ;
false**< A
,**A B
false**C H
,**H I
false**J O
,**O P
null**Q U
)**U V
;**V W
}++ 
channel-- 
=-- 

connection-- $
.--$ %
CreateModel--% 0
(--0 1
)--1 2
;--2 3
channel.. 
... 
BasicQos..  
(..  !
$num..! "
,.." #&
EmailConsumerPrefetchCount..$ >
,..> ?
false..@ E
)..E F
;..F G!
EventingBasicConsumer00 %
consumer00& .
=00/ 0
new001 4!
EventingBasicConsumer005 J
(00J K
channel00K R
)00R S
;00S T
consumer11 
.11 
Received11 !
+=11" $
(11% &
ch11& (
,11( )
FetchDigiPart11* 7
)117 8
=>119 ;
{22 
ProcessMessages33 #
(33# $
FetchDigiPart33$ 1
,331 2
channel333 :
,33: ;
$num33< =
)33= >
;33> ?
}44 
;44 
consumer55 
.55 
ConsumerTag55 $
=55% &
channel55' .
.55. /
BasicConsume55/ ;
(55; <
emailServiceQueue55< M
,55M N
false55O T
,55T U
consumer55V ^
)55^ _
;55_ `
}66 
catch77 
(77 
	Exception77 
ex77 
)77  
{88 

ServiceLog99 
model99  
=99! "
new99# &

ServiceLog99' 1
(991 2
)992 3
{:: 
error;; 
=;; 
ex;; 
.;; 
Message;; &
,;;& '

stackTrace<< 
=<<  
ex<<! #
.<<# $

StackTrace<<$ .
,<<. /
Source== 
=== 
$str== $
}>> 
;>> 

_IErrorLog?? 
.?? 
sendErrorQueue?? )
(??) *
model??* /
)??/ 0
;??0 1
}@@ 
}AA 	
privateCC 
voidCC 
ProcessMessagesCC $
(CC$ %!
BasicDeliverEventArgsCC% :
ModelCC; @
,CC@ A
IModelCCB H
channelCCI P
,CCP Q
intCCR U
processCountCCV b
)CCb c
{DD 	
tryEE 
{FF 
varGG 
bodyGG 
=GG 
ModelGG  
.GG  !
BodyGG! %
;GG% &
varHH 
messageHH 
=HH 
EncodingHH &
.HH& '
UTF8HH' +
.HH+ ,
	GetStringHH, 5
(HH5 6
bodyHH6 :
)HH: ;
;HH; <

EmailModelII 
	emailInfoII $
=II% &
JsonConvertII' 2
.II2 3
DeserializeObjectII3 D
<IID E

EmailModelIIE O
>IIO P
(IIP Q
messageIIQ X
)IIX Y
;IIY Z
ICommonApiEmailJJ 
_ICommonApiEmailJJ  0
=JJ1 2
UnityConfigJJ3 >
.JJ> ?
	ContainerJJ? H
.JJH I
ResolveJJI P
<JJP Q
ICommonApiEmailJJQ `
>JJ` a
(JJa b
	emailInfoJJb k
.JJk l!
mailSendProviderType	JJl Ä
)
JJÄ Å
;
JJÅ Ç
_ICommonApiEmailKK  
.KK  !
	SendEmailKK! *
(KK* +
	emailInfoKK+ 4
)KK4 5
;KK5 6
channelLL 
.LL 
BasicAckLL  
(LL  !
ModelLL! &
.LL& '
DeliveryTagLL' 2
,LL2 3
falseLL4 9
)LL9 :
;LL: ;
}MM 
catchNN 
(NN 
	ExceptionNN 
exNN 
)NN  
{OO 

ServiceLogPP 
modelPP  
=PP! "
newPP# &

ServiceLogPP' 1
(PP1 2
)PP2 3
{QQ 
errorRR 
=RR 
exRR 
.RR 
MessageRR &
,RR& '

stackTraceSS 
=SS  
exSS! #
.SS# $

StackTraceSS$ .
,SS. /
SourceTT 
=TT 
$strTT $
}UU 
;UU 

_IErrorLogVV 
.VV 
sendErrorQueueVV )
(VV) *
modelVV* /
)VV/ 0
;VV0 1
channelWW 
.WW 
BasicAckWW  
(WW  !
ModelWW! &
.WW& '
DeliveryTagWW' 2
,WW2 3
falseWW4 9
)WW9 :
;WW: ;
}XX 
}YY 	
}ZZ 
}[[ ‹
@D:\Development\FJT\FJT-DEV\fjt.emailservice\Handlers\ErrorLog.cs
	namespace 	
fjt
 
. 
emailservice 
. 
Handlers #
{ 
public 

class 
ErrorLog 
: 
	IErrorLog %
{ 
string 
ErroLogQueue 
=  
ConfigurationManager 2
.2 3
AppSettings3 >
[> ?
$str? M
]M N
.N O
ToStringO W
(W X
)X Y
;Y Z
string 
rabbitMqURI 
=  
ConfigurationManager 1
.1 2
AppSettings2 =
[= >
$str> K
]K L
.L M
ToStringM U
(U V
)V W
;W X
public 
static 
IConnection !

connection" ,
=- .
null/ 3
;3 4
public 
ErrorLog 
( 
) 
{ 	
ConnectionFactory 
factory %
=& '
new( +
ConnectionFactory, =
(= >
)> ?
;? @
factory 
. $
AutomaticRecoveryEnabled ,
=- .
true/ 3
;3 4
factory 
. 
Uri 
= 
new 
Uri !
(! "
rabbitMqURI" -
)- .
;. /
factory 
. 
UserName 
=  
ConfigurationManager 3
.3 4
AppSettings4 ?
[? @
$str@ R
]R S
;S T
factory 
. 
Password 
=  
ConfigurationManager 3
.3 4
AppSettings4 ?
[? @
$str@ R
]R S
;S T
factory 
. 
HostName 
=  
ConfigurationManager 3
.3 4
AppSettings4 ?
[? @
$str@ S
]S T
;T U
factory 
. 
VirtualHost 
=  ! 
ConfigurationManager" 6
.6 7
AppSettings7 B
[B C
$strC _
]_ `
;` a

connection 
= 
factory  
.  !
CreateConnection! 1
(1 2
)2 3
;3 4
} 	
public   
void   
sendErrorQueue   "
(  " #

ServiceLog  # -

ServiceLog  . 8
)  8 9
{!! 	
using"" 
("" 
var"" 
channel"" 
=""  

connection""! +
.""+ ,
CreateModel"", 7
(""7 8
)""8 9
)""9 :
{## 
string$$ 
	jsonified$$  
=$$! "
JsonConvert$$# .
.$$. /
SerializeObject$$/ >
($$> ?

ServiceLog$$? I
)$$I J
;$$J K
var%% 
body%% 
=%% 
Encoding%% #
.%%# $
UTF8%%$ (
.%%( )
GetBytes%%) 1
(%%1 2
	jsonified%%2 ;
)%%; <
;%%< =
var&& 

properties&& 
=&&  
channel&&! (
.&&( )!
CreateBasicProperties&&) >
(&&> ?
)&&? @
;&&@ A
channel'' 
.'' 
BasicPublish'' $
(''$ %
string''% +
.''+ ,
Empty'', 1
,''1 2
ErroLogQueue''3 ?
,''? @

properties''A K
,''K L
body''M Q
)''Q R
;''R S
}(( 
})) 	
}++ 
},, ¨
ZD:\Development\FJT\FJT-DEV\fjt.emailservice\Handlers\Interfaces\IEmailApiRequestHandler.cs
	namespace 	
fjt
 
. 
emailservice 
. 
Handlers #
{ 
public		 

	interface		 #
IEmailApiRequestHandler		 ,
{

 
void 
Process 
( 
) 
; 
} 
} Ó
LD:\Development\FJT\FJT-DEV\fjt.emailservice\Handlers\Interfaces\IErrorLog.cs
	namespace 	
fjt
 
. 
emailservice 
. 
Handlers #
.# $

Interfaces$ .
{		 
public

 	
	interface


 
	IErrorLog

 
{ 
void 
sendErrorQueue 
( 

ServiceLog &

ServiceLog' 1
)1 2
;2 3
} 
} °
JD:\Development\FJT\FJT-DEV\fjt.emailservice\Model\AttachmentDetailModel.cs
	namespace 	
fjt
 
. 
emailservice 
. 
Model  
{ 
public		 

class		 !
AttachmentDetailModel		 &
{

 
public 
string 
AttachmentName $
{% &
get' *
;* +
set, /
;/ 0
}1 2
public 
byte 
[ 
] 
BackupAttachment &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
} 
} ≠
?D:\Development\FJT\FJT-DEV\fjt.emailservice\Model\EmailModel.cs
	namespace 	
fjt
 
. 
emailservice 
. 
Model  
{		 
public

 

class

 

EmailModel

 
{ 
public 
string  
mailSendProviderType *
{+ ,
get- 0
;0 1
set2 5
;5 6
}7 8
public 
string 
From 
{ 
get  
;  !
set" %
;% &
}' (
public 
string 
To 
{ 
get 
; 
set  #
;# $
}% &
public 
string 
CC 
{ 
get 
; 
set  #
;# $
}% &
public 
string 
BCC 
{ 
get 
;  
set! $
;$ %
}& '
public 
string 
Subject 
{ 
get  #
;# $
set% (
;( )
}* +
public 
string 
Body 
{ 
get  
;  !
set" %
;% &
}' (
public 
List 
< 
string 
> 
Attachments '
{( )
get* -
;- .
set/ 2
;2 3
}4 5
public 
virtual 
ICollection "
<" #!
AttachmentDetailModel# 8
>8 9
attachmentDetail: J
{K L
getM P
;P Q
setR U
;U V
}W X
} 
} ˙
?D:\Development\FJT\FJT-DEV\fjt.emailservice\Model\ServiceLog.cs
	namespace 	
fjt
 
. 
emailservice 
. 
Model  
{ 
public 

class 

ServiceLog 
{ 
public 
string 
error 
{ 
get !
;! "
set# &
;& '
}( )
public 
string 

stackTrace  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
string 
Source 
{ 
get "
;" #
set$ '
;' (
}) *
} 
}		 º
6D:\Development\FJT\FJT-DEV\fjt.emailservice\Program.cs
	namespace		 	
fjt		
 
.		 
emailservice		 
{

 
static 

class 
Program 
{ 
public 
static 
EmailServices #
Service$ +
;+ ,
public 
static 
void 
Main 
( 
string %
[% &
]& '
args( ,
), -
{ 	
Service 
= 
new 
EmailServices '
(' (
)( )
;) *
ServiceBase 
[ 
] 
ServicesToRun '
;' (
if 
( 
! 
Environment 
. 
UserInteractive ,
), -
{ 
ServicesToRun 
= 
new  #
ServiceBase$ /
[/ 0
]0 1
{ 
new 
EmailServices %
(% &
)& '
} 
; 
ServiceBase 
. 
Run 
(  
ServicesToRun  -
)- .
;. /
} 
else 
{ 
Service 
. 
Start 
( 
args "
)" #
;# $
Thread   
.   
Sleep   
(   
Timeout   $
.  $ %
Infinite  % -
)  - .
;  . /
Service!! 
.!! 
Stop!! 
(!! 
)!! 
;!! 
}"" 
}## 	
}$$ 
}%% ›
?D:\Development\FJT\FJT-DEV\fjt.emailservice\ProjectInstaller.cs
	namespace		 	
fjt		
 
.		 
emailservice		 
{

 
[ 
RunInstaller 
( 
true 
) 
] 
public 

partial 
class 
ProjectInstaller )
:* +
System, 2
.2 3
Configuration3 @
.@ A
InstallA H
.H I
	InstallerI R
{ 
public 
ProjectInstaller 
(  
)  !
{ 	
InitializeComponent 
(  
)  !
;! "
} 	
} 
} Ò
FD:\Development\FJT\FJT-DEV\fjt.emailservice\Properties\AssemblyInfo.cs
[ 
assembly 	
:	 

AssemblyTitle 
( 
$str +
)+ ,
], -
[		 
assembly		 	
:			 

AssemblyDescription		 
(		 
$str		 !
)		! "
]		" #
[

 
assembly

 	
:

	 
!
AssemblyConfiguration

  
(

  !
$str

! #
)

# $
]

$ %
[ 
assembly 	
:	 

AssemblyCompany 
( 
$str 
) 
] 
[ 
assembly 	
:	 

AssemblyProduct 
( 
$str -
)- .
]. /
[ 
assembly 	
:	 

AssemblyCopyright 
( 
$str 0
)0 1
]1 2
[ 
assembly 	
:	 

AssemblyTrademark 
( 
$str 
)  
]  !
[ 
assembly 	
:	 

AssemblyCulture 
( 
$str 
) 
] 
[ 
assembly 	
:	 


ComVisible 
( 
false 
) 
] 
[ 
assembly 	
:	 

Guid 
( 
$str 6
)6 7
]7 8
[## 
assembly## 	
:##	 

AssemblyVersion## 
(## 
$str## $
)##$ %
]##% &
[$$ 
assembly$$ 	
:$$	 

AssemblyFileVersion$$ 
($$ 
$str$$ (
)$$( )
]$$) *ú
=D:\Development\FJT\FJT-DEV\fjt.emailservice\Utility\Helper.cs
	namespace 	
fjt
 
. 
emailservice 
. 
Utility "
{ 
public		 

static		 
class		 
Helper		 
{

 
public 
enum 
EmailAPINames !
{ 	
[ 
StringValue 
( 
$str "
)" #
]# $
Mailgun 
, 
[ 
StringValue 
( 
$str 
)  
]  !
Smtp 
} 	
} 
} Û
KD:\Development\FJT\FJT-DEV\fjt.emailservice\Utility\StringValueAttribute.cs
	namespace 	
fjt
 
. 
emailservice 
. 
Utility "
{ 
public		 

class		  
StringValueAttribute		 %
:		& '
System		( .
.		. /
	Attribute		/ 8
{

 
private 
string 
_value 
; 
public  
StringValueAttribute #
(# $
string$ *
value+ 0
)0 1
{ 	
_value 
= 
value 
; 
} 	
public 
string 
Value 
{ 	
get 
{ 
return 
_value 
;  
}! "
} 	
} 
} 