<md-dialog aria-label="Add Customer" flex="90" flex-lg="95" cg-busy="{promise:vm.cgBusyLoading}" draggable class="cm-custom-label-common">
  <form name="vm.AddCustomerForm" class="md-inline-form cm-mfgcode-popup" novalidate>
    <md-button id="btnRequireColValidation" type="submit" ng-hide="true"></md-button>
    <md-toolbar>
      <div class="md-toolbar-tools">
        <h2>{{vm.customer.id ? 'Update' : 'Add'}} {{vm.label}}<span ng-if="vm.customer.mfgCode || vm.autoCompletemfgCode.searchText">:&nbsp;{{vm.isMaster ? vm.customer.mfgCode : vm.autoCompletemfgCode.searchText}}</span></h2>
        <span flex></span>
        <md-button class="md-primary md-raised" id="headerAddBtn" ng-click="vm.saveAndProceed(vm.BUTTON_TYPE.ADDNEW)">Add {{vm.label}}</md-button>
        <md-button class="md-icon-button" ng-click="vm.cancel()">
          <md-icon role="img" md-font-icon="icon-close" class="material-icons mat-icon icon-close"></md-icon>
        </md-button>
      </div>
    </md-toolbar>
    <md-dialog-content class="customer-modal no-padding">
      <md-content class="padding-10">
        <div layout="row" flex="100" layout-md="column" layout-sm="column">
          <div layout="column" flex="100" flex-gt-sm="50" class="cm-section-main border-0">
            <div class="cm-section-inner padding-right-0-imp" flex="nogrow">
              <table cellspacing="0" cellpadding="0" class="cm-table-input-main">
                <tbody>
                  <tr>
                    <th><p class="label-container">{{vm.isMaster?'Code':'Search' + ' ' + vm.label + ' ' + 'Code and Add'}}<span>&nbsp;*<check-unique-on-blur></check-unique-on-blur></span></p></th>
                    <td colspan="{{vm.customerType == vm.CUSTOMER_TYPE_CONST.CUSTOMER?3:2}}">
                      <md-input-container class="autocompletecustom" ng-if="vm.isMaster">
                        <input type="text" class="input-text-uppercase" capitalize name="customerCode" ng-model="vm.customer.mfgCode"
                               required placeholder="Code" ng-maxlength="{{vm.mfgLength}}" md-maxlength="{{vm.mfgLength}}" allow-special-char-with-strict id="companyCode"
                               custom-blur="vm.checkDuplicateCustomerCode()" md-autofocus
                               ng-disabled="vm.customer.isMfgCodeUsedInFlow || vm.customer.isPricingApi || vm.customer.systemGenerated">
                        <div ng-messages="vm.AddCustomerForm.customerCode.$error" role="alert">
                          <div ng-message="required">
                            <span>{{vm.CORE_MESSAGE_CONSTANT.REQUIRED}}</span>
                          </div>
                          <div ng-message="maxlength">
                            <span>{{vm.getMaxLengthValidation(vm.mfgLength, vm.AddCustomerForm.customerCode.$viewValue.length)}}</span>
                          </div>
                        </div>
                      </md-input-container>
                      <md-input-container flex="100" ng-if="vm.autoCompletemfgCode && !vm.isMaster" class="autocompletecustom margin-top-0" custom-auto-focus="true" md-no-float>
                        <custom-auto-complete-search on-search-fn="vm.autoCompletemfgCode.onSearchFn"
                                                     column-name="vm.autoCompletemfgCode.columnName"
                                                     parent-column-name="vm.autoCompletemfgCode.parentColumnName"
                                                     key-column-name="vm.autoCompletemfgCode.keyColumnName"
                                                     input-name="vm.autoCompletemfgCode.inputName"
                                                     placeholder-name="vm.autoCompletemfgCode.placeholderName"
                                                     key-column-id="vm.autoCompletemfgCode.keyColumnId"
                                                     is-required="vm.autoCompletemfgCode.isRequired"
                                                     is-addnew="vm.autoCompletemfgCode.isAddnew"
                                                     on-select-callback-fn="vm.autoCompletemfgCode.onSelectCallbackFn"
                                                     callback-fn="vm.autoCompletemfgCode.callbackFn"
                                                     search-text="vm.autoCompletemfgCode.searchText"
                                                     md-require-match="false"
                                                     add-data="vm.autoCompletemfgCode.addData"
                                                     max-length="vm.mfgLength"
                                                     is-uppercase-search-text="vm.autoCompletemfgCode.isUppercaseSearchText">
                        </custom-auto-complete-search>
                      </md-input-container>
                    </td>
                  </tr>
                  <tr>
                    <th><p class="label-container">Business Name<span>&nbsp;*<check-unique-on-blur></check-unique-on-blur></span></p></th>
                    <td colspan="{{vm.customerType == vm.CUSTOMER_TYPE_CONST.CUSTOMER?3:2}}">
                      <md-input-container>
                        <input type="text" name="companyName" ng-model="vm.customer.mfgName" placeholder=">Business Name" required ng-maxlength="255" md-maxlength="255"
                               custom-blur="vm.checkDuplicateCompanyName();" id="companyName"
                               ng-disabled="vm.customer.isPricingApi || vm.customer.systemGenerated">
                        <div ng-messages="vm.AddCustomerForm.companyName.$error" role="alert">
                          <div ng-message="required">
                            <span>{{vm.CORE_MESSAGE_CONSTANT.REQUIRED}}</span>
                          </div>
                          <div ng-message="maxlength">
                            <span>{{vm.getMaxLengthValidation(255, vm.AddCustomerForm.companyName.$viewValue.length)}}</span>
                          </div>
                        </div>
                      </md-input-container>
                    </td>
                  </tr>
                  <tr>
                    <th><p class="label-container">Legal Name</p></th>
                    <td colspan="{{vm.customerType == vm.CUSTOMER_TYPE_CONST.CUSTOMER?3:2}}">
                      <md-input-container>
                        <input type="text" name="legalName" ng-model="vm.customer.legalName" placeholder=">Legal Name" ng-maxlength="255" md-maxlength="255"
                               ng-disabled="vm.mfgCodeModel.isPricingApi || vm.mfgCodeModel.systemGenerated" id="legalName">
                        <div>
                          <b>if different from above</b>
                        </div>
                        <div ng-messages="vm.AddCustomerForm.legalName.$error" role="alert">
                          <div ng-message="maxlength">
                            <span>{{vm.getMaxLengthValidation(255, vm.AddCustomerForm.legalName.$viewValue.length)}}</span>
                          </div>
                        </div>
                      </md-input-container>
                    </td>
                  </tr>
                  <tr>
                    <th></th>
                    <td colspan="3">
                      <primary-contact-persons-chip layout
                                                    param-contact-persons-det="vm.primaryContPersonsDet"
                                                    param-other-det="vm.contactPersonDetail"></primary-contact-persons-chip>
                    </td>
                  </tr>
                  <tr ng-if="vm.customerType == vm.CUSTOMER_TYPE_CONST.CUSTOMER">
                    <th ng-if="vm.customerType == vm.customerTypeConst.CUSTOMER">
                      <p class="label-container"><a class="cm-text-decoration" tabindex="-1" ng-click="vm.employeelist();">Sales Commission To</a><span>&nbsp;*</span></p>
                    </th>
                    <td ng-if="vm.customerType == vm.customerTypeConst.CUSTOMER">
                      <md-input-container ng-if="vm.autoCompleteSalesCommosssionTo" class="md-block autocompletecustom" flex="100">
                        <custom-auto-complete datalist="vm.SalesCommissionEmployeeList"
                                              column-name="vm.autoCompleteSalesCommosssionTo.columnName"
                                              key-column-name="vm.autoCompleteSalesCommosssionTo.keyColumnName"
                                              controller-name="vm.autoCompleteSalesCommosssionTo.controllerName"
                                              view-template-url="vm.autoCompleteSalesCommosssionTo.viewTemplateURL"
                                              input-name="vm.autoCompleteSalesCommosssionTo.inputName"
                                              placeholder-name="vm.autoCompleteSalesCommosssionTo.placeholderName"
                                              key-column-id="vm.autoCompleteSalesCommosssionTo.keyColumnId"
                                              is-required="vm.autoCompleteSalesCommosssionTo.isRequired"
                                              is-addnew="vm.autoCompleteSalesCommosssionTo.isAddnew"
                                              callback-fn="vm.autoCompleteSalesCommosssionTo.callbackFn">
                        </custom-auto-complete>
                      </md-input-container>
                    </td>
                    <th ng-if="vm.customerType === vm.customerTypeConst.CUSTOMER">
                      <p class="label-container">
                        <a class="cm-text-decoration" ng-click="vm.goToFOBList();">FOB</a>
                        <md-icon class="icon-question-mark-circle help-icon margin-right-0">
                          <md-tooltip md-direction="top">Free On Board</md-tooltip>
                        </md-icon>
                      </p>
                    </th>
                    <td>
                      <md-input-container ng-if="vm.autoCompleteFOB" class="autocompletecustom margin-bottom-0" flex="100">
                        <custom-auto-complete datalist="vm.FOBList"
                                              column-name="vm.autoCompleteFOB.columnName"
                                              controller-name="vm.autoCompleteFOB.controllerName"
                                              view-template-url="vm.autoCompleteFOB.viewTemplateURL"
                                              key-column-name="vm.autoCompleteFOB.keyColumnName"
                                              add-data="vm.autoCompleteFOB.addData"
                                              input-name="vm.autoCompleteFOB.inputName"
                                              placeholder-name="vm.autoCompleteFOB.placeholderName"
                                              key-column-id="vm.autoCompleteFOB.keyColumnId"
                                              is-disabled="vm.isDisable"
                                              is-addnew="vm.autoCompleteFOB.isAddnew"
                                              callback-fn="vm.autoCompleteFOB.callbackFn">
                        </custom-auto-complete>
                      </md-input-container>
                    </td>
                  </tr>
                  <tr ng-if="vm.customerType == vm.CUSTOMER_TYPE_CONST.CUSTOMER">
                    <th><p class="label-container">{{vm.MFRDateCodeFormat}}</p></th>
                    <td>
                      <div flex>
                        <md-input-container ng-if="vm.autoCompleteDateCodeFormat" class="autocompletecustom margin-bottom-0 cm-warehouse-nickname-auto cm-nickname-popup" custom-auto-focus="{{vm.focusDateCode ? true : false}}">
                          <custom-auto-complete datalist="vm.dateCodeFormatList"
                                                column-name="vm.autoCompleteDateCodeFormat.columnName"
                                                key-column-name="vm.autoCompleteDateCodeFormat.keyColumnName"
                                                controller-name="vm.autoCompleteDateCodeFormat.controllerName"
                                                view-template-url="vm.autoCompleteDateCodeFormat.viewTemplateURL"
                                                input-name="vm.autoCompleteDateCodeFormat.inputName"
                                                placeholder-name="vm.autoCompleteDateCodeFormat.placeholderName"
                                                key-column-id="vm.autoCompleteDateCodeFormat.keyColumnId"
                                                is-addnew="vm.autoCompleteDateCodeFormat.isAddnew"
                                                is-required="vm.autoCompleteDateCodeFormat.isRequired"
                                                callback-fn="vm.autoCompleteDateCodeFormat.callbackFn"
                                                on-select-callback-fn="vm.autoCompleteDateCodeFormat.onSelectCallbackFn">
                          </custom-auto-complete>
                        </md-input-container>
                      </div>
                    </td>
                    <th><p class="label-container">Customer Type<span>&nbsp;*</span></p></th>
                    <td>
                      <div flex>
                        <md-input-container ng-if="vm.autoCompleteCustomerType" class="autocompletecustom margin-bottom-0">
                          <custom-auto-complete datalist="vm.customerTypeList"
                                                column-name="vm.autoCompleteCustomerType.columnName"
                                                key-column-name="vm.autoCompleteCustomerType.keyColumnName"
                                                input-name="vm.autoCompleteCustomerType.inputName"
                                                placeholder-name="vm.autoCompleteCustomerType.placeholderName"
                                                key-column-id="vm.autoCompleteCustomerType.keyColumnId"
                                                is-required="vm.autoCompleteCustomerType.isRequired">
                          </custom-auto-complete>
                        </md-input-container>
                      </div>
                    </td>
                  </tr>
                  <tr ng-if="vm.customerType == vm.CUSTOMER_TYPE_CONST.CUSTOMER">
                    <th class="padding-top-10">
                      <p class="label-container">
                        <a tabindex="-1" class="cm-text-decoration" ng-click="vm.goToMFGList();">Manufacturer Mapping</a>
                      </p>
                    </th>
                    <td colspan="3">
                      <md-input-container ng-if="vm.autoCompleteMappingMfgCode" class="autocompletecustom margin-bottom-0 margin-top-4" flex="100" id="autoMFGCode">
                        <custom-auto-complete-search class="min-width-initial"
                                                     on-search-fn="vm.autoCompleteMappingMfgCode.onSearchFn"
                                                     column-name="vm.autoCompleteMappingMfgCode.columnName"
                                                     controller-name="vm.autoCompleteMappingMfgCode.controllerName"
                                                     view-template-url="vm.autoCompleteMappingMfgCode.viewTemplateURL"
                                                     key-column-name="vm.autoCompleteMappingMfgCode.keyColumnName"
                                                     input-name="vm.autoCompleteMappingMfgCode.inputName"
                                                     placeholder-name="vm.autoCompleteMappingMfgCode.placeholderName"
                                                     key-column-id="vm.autoCompleteMappingMfgCode.keyColumnId"
                                                     is-required="vm.autoCompleteMappingMfgCode.isRequired"
                                                     parent-column-name="vm.autoCompleteMappingMfgCode.parentColumnName"
                                                     is-addnew="vm.autoCompleteMappingMfgCode.isAddnew"
                                                     add-data="vm.autoCompleteMappingMfgCode.addData"
                                                     callback-fn="vm.autoCompleteMappingMfgCode.callbackFn"
                                                     on-select-callback-fn="vm.autoCompleteMappingMfgCode.onSelectCallbackFn">
                        </custom-auto-complete-search>
                      </md-input-container>
                      <div flex="100" layout="row" class="part-attribute-body" layout-align="start center" layout-wrap>
                        <div ng-repeat="item in vm.customer.manufacturerMapping" layout="row" layout-align="start center" class="cm-tracking-chip-mian">
                          <div class="tracking-number-chip" layout="row" layout-align="start center">
                            <label>
                              <a class="cm-text-decoration" ng-click="vm.goToManufacturer(item.refMfgCodeMstID)">
                                <span>{{item.mfgCode}}</span>
                              </a>
                            </label>
                            <md-button class="md-icon-button md-primary md-mini" ng-click="vm.removeManufacturer(item, $index)">
                              <md-icon md-font-icon="icon-close" class="material-icons mat-icon"></md-icon>
                              <md-tooltip>Remove Manufacturer</md-tooltip>
                            </md-button>
                          </div>
                        </div>
                      </div>
                    </td>
                  </tr>
                  <tr>
                    <th><p class="label-container">Internal Comments</p></th>
                    <td colspan="3">
                      <md-input-container flex="100">
                        <textarea name="Comments" ng-maxlength="1000" md-maxlength="1000" ng-model="vm.customer.comments" rows="2" placeholder="Comments"></textarea>
                        <div ng-messages="vm.AddCustomerForm.Comments.$error" role="alert">
                          <div ng-message="maxlength">
                            <span>
                              {{vm.getMaxLengthValidation(1000, vm.AddCustomerForm.Comments.$viewValue.length)}}
                            </span>
                          </div>
                        </div>
                      </md-input-container>
                    </td>
                  </tr>
                  <tr>
                    <th><p class="label-container">Alias<span>&nbsp;</span></p></th>
                    <td colspan="{{vm.customerType == vm.CUSTOMER_TYPE_CONST.CUSTOMER?3:2}}">
                      <div layout="row" flex="100">
                        <div layout="row" flex="80">
                          <md-input-container class="margin-bottom-0 md-block" flex="100">
                            <input type="text" name="mfgcodealias" ng-model="vm.alias"
                                   placeholder="Alias" capitalize class="input-text-uppercase" ng-maxlength="255" md-maxlength="255"
                                   my-enter="vm.updateAliasList(vm.alias);" data-focusButton="saveCustomerBtn"
                                   last-element elementcondition="{{(!vm.alias && (vm.customer.alias.length <= 0) ? true : false)}}">
                            <div ng-messages="vm.AddCustomerForm.mfgcodealias.$error"
                                 role="alert">
                              <div ng-message="maxlength">
                                <span>{{vm.getMaxLengthValidation(255, vm.AddCustomerForm.mfgcodealias.$viewValue.length)}}</span>
                              </div>
                            </div>
                          </md-input-container>
                        </div>
                        <div layout="row" layout-align="end center" flex="20">
                          <md-button class="md-primary md-raised margin-0" ng-disabled="!vm.alias" ng-click="vm.updateAliasList(vm.alias);" aria-label="Add"
                                     data-focusButton="saveCustomerBtn" last-element elementcondition="{{(vm.alias && (vm.customer.alias.length <= 0) ? true : false)}}">Add Alias</md-button>
                        </div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div flex="noshrink" layout-wrap>
              <div layout="row" class="height-100p" flex="100">
                <div layout="column" flex>
                  <div layout="column" class="alias-list-main cm-add-cus cm-manufacture-alias-list" flex>
                    <div class="mobilesearch title alias-list-title userpermissionhead" layout="row" flex="100">
                      <div layout="row" flex="100" layout-align="space-between center" ng-if="vm.customer.alias.length > 0">
                        <md-input-container class="md-block error-none no-label" md-no-float flex flex-xs="75">
                          <input type="text" class="font-weight-400" placeholder="Type here to search alias" ng-model="vm.Search">
                        </md-input-container>
                        <md-button class="md-raised md-primary md-ink-ripple margin-0"
                                   ng-disabled="vm.Search =='' || vm.Search ==null"
                                   ng-click="vm.Search=''">
                          Clear
                        </md-button>
                      </div>
                    </div>
                    <div layout="row" flex="100" layout-wrap class="detail dossection padding-10 custom-scroll" ng-if="vm.customer.alias.length > 0">
                      <table class="simple no-padding" ms-responsive-table="">
                        <thead>
                          <tr>
                            <th width="120">Alias</th>
                            <th class="text-center">Action</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr ng-repeat="alias in vm.customer.alias | filter:vm.Search | orderBy:'index'" class="height-40">
                            <td width="300" class="font-size-14 word-break">
                              {{alias.alias}}
                            </td>
                            <td width="100" class="text-center font-size-14">
                              <button class="md-mini md-icon-button margin-0" data-focusButton="saveCustomerBtn" ng-if="alias.id"
                                      last-element elementcondition="{{((alias.isDefaultAlias || vm.customer.isPricingApi) && ((!vm.isAllowDeleteCustSuppAlias && alias.id) || alias.isSystemGenerated) && ((vm.customer.alias.length - 1) == $index) ? true : false)}}">
                                <md-icon md-font-icon="icon-eye"></md-icon>
                                <md-tooltip md-direction="top" class="tt-multiline">
                                  Created By: {{alias.employeeName}} <br />
                                  Created At: {{alias.createdAtValue}}
                                </md-tooltip>
                              </button>
                              <md-button class="md-mini md-icon-button margin-0" ng-if="alias.id"
                                         ng-disabled="alias.isDefaultAlias || vm.customer.isPricingApi" data-focusButton="saveCustomerBtn"
                                         last-element elementcondition="{{(((!vm.isAllowDeleteCustSuppAlias && alias.id) || alias.isSystemGenerated) && ((vm.customer.alias.length - 1) == $index) ? true : false)}}"
                                         ng-click="vm.setAliasAsDefault(alias)">
                                <!--<md-icon md-font-icon="{{alias.isDefaultAlias ? 'icon-pin-off' : 'icon-pin'}}"></md-icon><md-tooltip>Set as Default</md-tooltip>-->
                                <md-icon md-font-icon="{{alias.isDefaultAlias ? 'icons-pin' : 'icons-unpin'}}"></md-icon><md-tooltip>Set as Default</md-tooltip>
                              </md-button>
                              <md-button class="md-mini md-icon-button margin-0" ng-disabled="(!vm.isAllowDeleteCustSuppAlias && alias.id) || alias.isSystemGenerated"
                                         ng-click="vm.removeAliasFromList($event,$index)" data-focusButton="saveCustomerBtn"
                                         last-element elementcondition="{{((!(!vm.isAllowDeleteCustSuppAlias && alias.id) || alias.isSystemGenerated) && ((vm.customer.alias.length - 1) == $index) ? true : false)}}">
                                <md-icon md-font-icon="icon-trash"></md-icon><md-tooltip>Delete</md-tooltip>
                              </md-button>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                      <div flex="100" class="md-1-line margin-0 dragsortable" layout="row" layout-align="start center"
                           ng-if="(vm.customer.alias | filter:vm.Search).length==0 && vm.customer.alias.length > 0">
                        <div class="empty-state text-center full-height" layout="row" layout-align="center center" layout-wrap flex="100">
                          <p flex="100" class="empty-state-title">{{vm.EmptyMesssageAliaslist.EMPTY_SEARCH_MESSAGE}}</p>
                        </div>
                      </div>
                    </div>
                    <div flex="100" class="md-1-line margin-0 dragsortable" layout="row" layout-align="start center" ng-if="!vm.customer.alias || vm.customer.alias.length == 0">
                      <div class="empty-state text-center full-height" layout="row" layout-align="center center" layout-wrap flex="100">
                        <p flex="100" class="empty-state-title">{{vm.EmptyMesssageAliaslist.MESSAGE}}</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="cm-allmfg-divider-vertical"></div>
          <div layout="row" layout-gt-xs="row" flex-gt-sm="50" flex="100" ng-if="vm.isShowAllMFGCustList">
            <manufacturers-list flex="100" type="vm.mfgType"
                                apply-as-customer-callback-fn="vm.customerDetails"
                                from-page-request="vm.fromPageRequest"
                                is-change-from-popup="true">
            </manufacturers-list>
          </div>
        </div>
      </md-content>
    </md-dialog-content>

    <md-dialog-actions layout="row">
      <md-button class="md-default md-raised" ng-click="vm.cancel()">Cancel</md-button>
      <md-button class="md-primary md-raised" ng-click="vm.SaveCustomer(true,vm.BUTTON_TYPE.SAVE)" id="saveCustomerBtn" aria-label="Submit" ng-class="{'md-formdirty': vm.checkFormDirty(vm.AddCustomerForm)}">Save</md-button>
      <md-button class="md-primary md-raised" data-focusButton="headerAddBtn" last-element elementcondition="true" ng-click="vm.SaveCustomer(true,vm.BUTTON_TYPE.SAVEANDEXIT);" aria-label="Submit" ng-class="{'md-formdirty': vm.checkFormDirty(vm.AddCustomerForm)}">{{vm.CORE_MESSAGE_CONSTANT.SAVE_AND_EXIT}}</md-button>
    </md-dialog-actions>
  </form>
</md-dialog>
