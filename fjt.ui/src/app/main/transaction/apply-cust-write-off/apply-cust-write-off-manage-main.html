<div id="forms" class="page-layout simple fullwidth doc-page breadcrumb-fixed cm-warehouse-bin-navbar cm-custom-label-common" layout="column" cg-busy="{promise:vm.cgBusyLoading}">
  <div class="header md-accent-bg" layout="row" layout-align="space-between center">
    <div class="white-fg" flex="50" flex-lg="45" flex-xl="40" layout="row" layout-align="start start">
      <div>
        <md-button class="goto-rfq-button md-icon-button cm-back-btn-p-m" type="button" aria-label="Go to Applied Write Off List" ng-click="vm.goBack()">
          <md-icon md-font-icon="icons-backarrow" class="material-icons icons-backarrow cm-back-btn">
          </md-icon>
          <md-tooltip>Back to Applied Customer Write Off List</md-tooltip>
        </md-button>
      </div>
      <div layout="row" flex>
        <div layout="column">
          <div>
            <pagetitle is-list="false"
                       is-display-menu-name="true"
                       prefix-content=""
                       suffix-content="vm.custPaymentMstID ? (': ' + vm.paymentNumber) : ''"
                       prefix-page-title=""></pagetitle>
            <md-tooltip md-direction="right" ng-if="vm.paymentNumber">{{vm.paymentNumber}}</md-tooltip>
          </div>
          <div layout="row">
            <breadcrumbs></breadcrumbs>
          </div>
        </div>
        <div layout="column" flex class="margin-left-20 cm-header-search-add-container">
          <div>
            <md-input-container ng-if="vm.autoCompleteCustPaymentCheckNumber" class="width-100p autocompletecustom margin-0 widget-dashboard-search-area" flex="100" flex-gt-xs="100">
              <custom-auto-complete-search on-search-fn="vm.autoCompleteCustPaymentCheckNumber.onSearchFn"
                                           column-name="vm.autoCompleteCustPaymentCheckNumber.columnName"
                                           key-column-name="vm.autoCompleteCustPaymentCheckNumber.keyColumnName"
                                           input-name="vm.autoCompleteCustPaymentCheckNumber.inputName"
                                           placeholder-name="vm.autoCompleteCustPaymentCheckNumber.placeholderName"
                                           key-column-id="vm.autoCompleteCustPaymentCheckNumber.keyColumnId"
                                           is-required="vm.autoCompleteCustPaymentCheckNumber.isRequired"
                                           is-addnew="vm.autoCompleteCustPaymentCheckNumber.isAddnew"
                                           callback-fn="vm.autoCompleteCustPaymentCheckNumber.callbackFn"
                                           on-select-callback-fn="vm.autoCompleteCustPaymentCheckNumber.onSelectCallbackFn">
            </md-input-container>
          </div>
          <div class="cm-square-icon-btn pt-2">
            <md-button class="md-icon-button mv-0-imp margin-right-5-imp md-primary md-raised"
                       ng-if="vm.custPaymentMstID"
                       ng-click="vm.applyCustWriteOff(true)">
              <md-icon md-font-icon="t-icons-customer-write-off add-icon" class="material-icons"></md-icon>
              <md-tooltip>Apply Write Off to Invoice In New Tab</md-tooltip>
            </md-button>
            <md-button class="md-icon-button mv-0-imp margin-right-5-imp md-primary md-raised"
                       ng-if="vm.custPaymentMstID"
                       ng-click="vm.applyCustWriteOff(false)">
              <md-icon md-font-icon="t-icons-customer-write-off add-icon same-tab-icon" class="material-icons"></md-icon>
              <md-tooltip>Apply Write Off to Invoice</md-tooltip>
            </md-button>
          </div>
        </div>
      </div>
    </div>
    <div layout="row" flex layout-align="start end" class="pl-10">
      <table cellspacing="0" cellpadding="0" class="cm-header-data-table">
        <tbody>
          <tr>
            <th ng-if="vm.selectedCustomerDet">
              <a class="cursor-pointer text-underline" ng-click="vm.goToCustomerList();">Customer</a>:
            </th>
            <td class="color-black" ng-if="vm.selectedCustomerDet">
              <span class="cm-name text-underline cursor-pointer"
                    ng-click="vm.selectedCustomerDet.id ? vm.goToCustomerDetail() : ''">
                <md-tooltip ng-if="vm.selectedCustomerDet.mfgFullName">{{vm.selectedCustomerDet.mfgFullName || '-'}}</md-tooltip>
                <b>{{vm.selectedCustomerDet.mfgFullName || '-'}}</b>
              </span>
            </td>
            <th ng-if="vm.custPaymentMstDetParent.refPaymentID">
              <a class="cursor-pointer text-underline" ng-click="vm.goToCustomerPaymentList();">Ref. Payment</a>:
            </th>
            <td class="color-black" ng-if="vm.custPaymentMstDetParent.refPaymentID">
              <span class="cm-name text-underline cursor-pointer"
                    ng-click="vm.goToCustomerPaymentDetail()">
                <md-tooltip ng-if="vm.custPaymentMstDetParent.refPaymentNumFromTransInitiate">{{vm.custPaymentMstDetParent.refPaymentNumFromTransInitiate}}</md-tooltip>
                <b>{{vm.custPaymentMstDetParent.refPaymentNumFromTransInitiate}}</b>
              </span>
            </td>
          </tr>
          <tr>
            <th ng-if="vm.custPaymentMstDetParent.id">
              <span>
                <a class="cursor-pointer text-underline" ng-click="vm.goToAppliedCustWriteOffToInvList();">Write Off#</a>:
              </span>
            </th>
            <td ng-if="vm.custPaymentMstDetParent.id">
              <span class="cm-data">
                <md-tooltip ng-if="vm.paymentNumber">{{vm.paymentNumber}}</md-tooltip>
                <b>{{vm.paymentNumber || '-'}}</b>
              </span>
              <copy-text label="'Write Off#'" text="vm.paymentNumber"></copy-text>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="mr-10" layout>
      <span class="label-box padding-5-imp width-75 label-danger ml-5"
            ng-if="vm.custPaymentMstDetParent.isCustPaymentLocked">
        Locked
        <md-tooltip md-direction="bottom" class="tt-multiline"
                    ng-if="vm.custPaymentMstDetParent.isCustPaymentLocked">
          Locked By: {{vm.custPaymentMstDetParent.lockedByUserFullName}} <br />
          Locked Date: {{vm.custPaymentMstDetParent.lockedAt}}
        </md-tooltip>
      </span>
    </div>
    <div class="ml-25 mr-5" ng--if="vm.custPaymentMstDetParent.isPaymentVoidedConvertedValue">
      <span class="label-box padding-5-imp" ng-if="vm.custPaymentMstID && vm.custPaymentMstDetParent"
            ng-class="vm.getCustPaymentStatusClassName(vm.custPaymentMstDetParent.isPaymentVoidedConvertedValue)">
        {{vm.custPaymentMstDetParent.isPaymentVoidedConvertedValue}}
      </span>
    </div>
    <div layout="row" layout-wrap layout-align="start center">
      <div layout="row" layout-align="center center" class="cm-square-icon-btn cm-btn-group">
        <md-button class="md-icon-button margin-0 md-primary md-raised md-mini margin-left-10"
                   ng-click="vm.viewWriteOffHistory()"
                   ng-if="vm.custPaymentMstID && vm.custPaymentMstDetParent">
          <md-icon md-font-icon="t-icons-history-text" class="material-icons"></md-icon>
          <md-tooltip>Write Off History</md-tooltip>
        </md-button>
        <md-button class="md-primary md-raised"
                   ng-disabled="vm.saveBtnDisableFlag || vm.custPaymentMstDetParent.isPaymentVoided || vm.custPaymentMstDetParent.isCustPaymentLocked"
                   ng-class="{'md-formdirty': vm.custPaymentWriteOffForm.$dirty}"
                   id="saveBtn" ng-click="vm.saveCustomerPayment();"
                   ng-if="vm.activeTab==vm.applyCustWriteOffManageTabIDsConst.Detail">
          Save
        </md-button>
        <md-menu-bar id="user-menu" class="" layout-align="start-center" layout="row"
                     ng-if="vm.activeTab==vm.applyCustWriteOffManageTabIDsConst.Detail">
          <md-menu md-position-mode="left bottom">
            <md-button class="" ng-click="$mdOpenMenu()"
                       aria-label="User settings">
              <div layout="row" layout-align="space-between center">
                <span class="color-white font-size-13 font-weight-normal">Menu Items</span>
                <md-icon md-font-icon="icon-chevron-down"
                         class="icon s16 color-white" hide-sm></md-icon>
              </div>
            </md-button>
            <md-menu-content width="3">
              <md-menu-item>
                <md-button class=""
                           ng-click="vm.goToCustomerInvoiceList();">
                  Customer Invoices
                </md-button>
              </md-menu-item>
              <md-menu-item ng-if="vm.custPaymentMstID && !vm.custPaymentMstDetParent.isPaymentVoided">
                <md-button class="cm-feture-btn-color"
                           ng-click="vm.voidWriteOffPaymentAndReleaseInvGroup($event);"
                           ng-disabled="!vm.allowToVoidCustWriteOffAndReleaseInv || vm.custPaymentMstDetParent.isPaymentVoided"
                           ng-class="{'item-disabled': !vm.allowToVoidCustWriteOffAndReleaseInv || vm.custPaymentMstDetParent.isPaymentVoided}">
                  Void WOFF & Release Invoice Group
                </md-button>
              </md-menu-item>
            </md-menu-content>
          </md-menu>
        </md-menu-bar>
      </div>
    </div>
  </div>

  <div class="content-card padding-top-side" layout="row" flex="100">
    <md-content flex="100" layout="column">
      <ms-form-wizard flex>
        <md-tabs validate-step="true" is-valid="vm.isStepValid" md-dynamic-height md-border-bottom md-selected="vm.activeTab" class="cm-fullheight manage-customer-tabing padding-0">
          <md-tab ng-repeat="item in vm.tabList" ng-disabled="item.isDisabled"
                  md-on-select="vm.onTabChanges(item)">
            <md-tab-label>
              <span class="ms-form-wizard-step-label">
                <span class="ms-form-wizard-step-text">
                  {{item.title}}<span ng-if="item.id==vm.applyCustWriteOffManageTabIDsConst.Document">&nbsp;({{vm.documentCountOfAppliedWriteOff}})</span>
                </span>
              </span>
            </md-tab-label>
            <md-tab-body>
              <div class="" ui-view="{{item.viewsrc}}"></div>
            </md-tab-body>
          </md-tab>
        </md-tabs>
      </ms-form-wizard>
    </md-content>
  </div>
</div>


