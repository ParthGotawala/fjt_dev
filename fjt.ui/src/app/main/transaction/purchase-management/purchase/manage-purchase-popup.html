<md-dialog aria-label="Add Purchase" class="cm-custom-label-common receiving-pop-main"  cg-busy="{promise:vm.cgBusyLoading}" draggable>
  <form name="vm.ManagePurchaseForm">
    <md-toolbar>
      <div class="md-toolbar-tools">
        <h2>Purchase List Details</h2>
        <span flex></span>
        <div layout="row" layout-align="center center">
          <popup-header-label label-data="vm.headerdata"></popup-header-label>
        </div>
        <md-button class="md-icon-button" ng-click="vm.cancel()">
          <md-icon role="img" md-font-icon="icon-close" class="material-icons mat-icon icon-close"></md-icon>
        </md-button>
      </div>
    </md-toolbar>
    <md-dialog-content class="no-padding" layout="column">
      <md-content class="padding-10">
        <div flex="100" layout="row" layout-wrap>
          <div class="cm-section-main" layout="row" layout-wrap flex="100">
            <!--<div class="cm-section-header" flex="100">
              <h2>Add Purchase Details</h2>
            </div>-->
            <div class="cm-section-inner" flex="100" layout="row">
              <div flex="100">
                <table cellspacing="0" cellpadding="0" class="cm-table-input-main">
                  <tr>
                    <th colspan="2" ng-if="vm.autoCompletePID">
                      <p class="label-container">
                        <a class="cm-text-decoration underline" ng-click="vm.goToPartList();" tabindex="-1">{{vm.LabelConstant.MFG.PID}}</a>
                        <span ng-if="vm.autoCompletePID.isRequired">&nbsp;*</span>
                      </p>
                    </th>
                    <td colspan="3" ng-if="vm.autoCompletePID">
                      <md-input-container class="autocompletecustom cm-custom-autocomplete margin-0" flex="100">
                        <custom-auto-complete datalist="vm.PIDCodeList"
                                              column-name="vm.autoCompletePID.columnName"
                                              key-column-name="vm.autoCompletePID.keyColumnName"
                                              input-name="vm.autoCompletePID.inputName"
                                              placeholder-name="vm.autoCompletePID.placeholderName"
                                              key-column-id="vm.autoCompletePID.keyColumnId"
                                              is-required="vm.autoCompletePID.isRequired"
                                              on-select-callback-fn="vm.autoCompletePID.onSelectCallbackFn"
                                              custom-auto-focus="{{true}}">
                        </custom-auto-complete>
                      </md-input-container>
                    </td>
                    <th colspan="2" ng-if="vm.autoCompletemfgCode">
                      <p class="label-container">
                        <a class="cm-text-decoration underline" ng-click="vm.goToManufacturerList();" tabindex="-1">Supplier Code</a>
                        <span ng-if="vm.autoCompletemfgCode.isRequired">&nbsp;*</span>
                      </p>
                    </th>
                    <td colspan="3" ng-if="vm.autoCompletemfgCode">
                      <md-input-container class="autocompletecustom cm-custom-autocomplete" flex="100">
                        <custom-auto-complete-search on-search-fn="vm.autoCompletemfgCode.onSearchFn"
                                                     column-name="vm.autoCompletemfgCode.columnName"
                                                     controller-name="vm.autoCompletemfgCode.controllerName"
                                                     parent-column-name="vm.autoCompletemfgCode.parentColumnName"
                                                     view-template-url="vm.autoCompletemfgCode.viewTemplateURL"
                                                     key-column-name="vm.autoCompletemfgCode.keyColumnName"
                                                     input-name="vm.autoCompletemfgCode.inputName"
                                                     placeholder-name="vm.autoCompletemfgCode.placeholderName"
                                                     key-column-id="vm.autoCompletemfgCode.keyColumnId"
                                                     is-required="vm.autoCompletemfgCode.isRequired"
                                                     is-addnew="vm.autoCompletemfgCode.isAddnew"
                                                     callback-fn="vm.autoCompletemfgCode.callbackFn"
                                                     parent-id=""
                                                     add-data="vm.autoCompletemfgCode.addData"
                                                     on-select-callback-fn="vm.autoCompletemfgCode.onSelectCallbackFn"
                                                     is-uppercase-search-text="vm.autoCompletemfgCode.isUppercaseSearchText"
                                                     is-disabled="vm.purchase.id">
                        </custom-auto-complete-search>
                      </md-input-container>
                    </td>

                    <th colspan="2">
                      <p class="label-container">
                        {{vm.LabelConstant.Purchase.PO}}<span>&nbsp;*</span>
                      </p>
                    </th>
                    <td colspan="3">
                      <div layout="row" ng-if="vm.autoCompletePONumber">
                        <md-input-container flex class="autocompletecustom cm-custom-autocomplete">
                          <custom-auto-complete-search on-search-fn="vm.autoCompletePONumber.onSearchFn"
                                                       column-name="vm.autoCompletePONumber.columnName"
                                                       parent-column-name="vm.autoCompletePONumber.parentColumnName"
                                                       key-column-name="vm.autoCompletePONumber.keyColumnName"
                                                       input-name="vm.autoCompletePONumber.inputName"
                                                       placeholder-name="vm.autoCompletePONumber.placeholderName"
                                                       key-column-id="vm.autoCompletePONumber.keyColumnId"
                                                       is-required="vm.autoCompletePONumber.isRequired"
                                                       is-addnew="vm.autoCompletePONumber.isAddnew"
                                                       on-select-callback-fn="vm.autoCompletePONumber.onSelectCallbackFn"
                                                       callback-fn="vm.autoCompletePONumber.callbackFn"
                                                       search-text="vm.autoCompletePONumber.searchText"
                                                       md-require-match="vm.autoCompletePONumber.matchRequired"
                                                       add-data="vm.autoCompletePONumber.addData"
                                                       is-disabled="!vm.autoCompletemfgCode.keyColumnId"
                                                       is-uppercase-search-text="vm.autoCompletePONumber.isUppercaseSearchText">
                          </custom-auto-complete-search>
                        </md-input-container>
                      </div>
                    </td>
                    <th colspan="2">
                      <p class="label-container">
                        {{vm.LabelConstant.Purchase.PODate}}<span>&nbsp;*</span>
                      </p>
                    </th>
                    <td colspan="3">
                      <div layout="row">
                        <md-input-container flex>
                          <input type="text" class="float-left"
                                 name="poDate"
                                 min-value="vm.minDate"
                                 allow-past-date="true"
                                 allow-future-date="true"
                                 datetime-picker="{{$root.dateDisplayFormat}}"
                                 ng-model="vm.purchase.poDate"
                                 enable-time="false"
                                 ui-options="{clearOnBlur  : true}"
                                 ui-mask="{{$root.uimaskFormat.date.mask}}"
                                 ui-mask-placeholder="{{$root.uimaskFormat.date.placeholder}}"
                                 model-view-value="true"
                                 datepicker-options="vm.poDateOptions"
                                 is-open="vm.poDateOptions.poDateOpenFlag"
                                 ng-required="true"
                                 ng-disabled="vm.autoCompletePONumber.keyColumnId"/>
                          <md-icon md-font-icon="icon-calendar calender-icon"
                                   ng-click="vm.poDateOptions.poDateOpenFlag = (vm.autoCompletePONumber.keyColumnId?false:true)"
                                   ng-disabled="vm.autoCompletePONumber.keyColumnId">
                          </md-icon>
                          <div ng-messages="vm.ManagePurchaseForm.poDate.$error"
                               role="alert" ng-if="vm.ManagePurchaseForm.poDate.$touched">
                            <div ng-message="required">
                              <span>{{vm.CORE_MESSAGE_CONSTANT.REQUIRED}}</span>
                            </div>
                            <div ng-message="valid || mindate || minvalue">
                              <span>{{vm.CORE_MESSAGE_CONSTANT.INVALID}}</span>
                            </div>
                          </div>
                        </md-input-container>
                      </div>
                    </td>
                  </tr>
                  <tr>
                    <th colspan="2">
                      <p class="label-container">
                        {{vm.LabelConstant.Purchase.SO}}
                      </p>
                    </th>
                    <td colspan="3">
                      <div layout="row">
                        <md-input-container flex>
                          <input type="text" name="soNumber" ng-model="vm.purchase.soNumber"
                                 placeholder="{{vm.LabelConstant.Purchase.SO}}"
                                 ng-required="false"
                                 ng-maxlength="100">
                          <div ng-messages="vm.ManagePurchaseForm.soNumber.$error"
                               role="alert" ng-if="vm.ManagePurchaseForm.soNumber.$touched">
                            <div ng-message="required">
                              <span>{{vm.CORE_MESSAGE_CONSTANT.REQUIRED}}</span>
                            </div>
                            <div ng-message="maxlength">
                              <span>{{vm.getMaxLengthValidation(100, vm.ManagePurchaseForm.soNumber.$viewValue.length)}}</span>
                            </div>
                          </div>
                        </md-input-container>
                      </div>
                    </td>
                    <th colspan="2">
                      <p class="label-container">
                        {{vm.LabelConstant.Purchase.PurchasedQty}}<span>&nbsp;*</span>
                      </p>
                    </th>
                    <td colspan="3">
                      <div layout="row">
                        <md-input-container flex>
                          <input type="number" name="poQty" min="1" step="1" ng-model="vm.purchase.poQty"
                                 placeholder="{{vm.LabelConstant.Purchase.PurchasedQty}}"
                                 ng-change="vm.getExtendedPrice()"
                                 ng-required="true"
                                 ng-maxlength="11">
                          <div ng-messages="vm.ManagePurchaseForm.poQty.$error"
                               role="alert" ng-if="vm.ManagePurchaseForm.poQty.$touched">
                            <div ng-message="required">
                              <span>{{vm.CORE_MESSAGE_CONSTANT.REQUIRED}}</span>
                            </div>
                            <div ng-message="maxlength">
                              <span>{{vm.getMaxLengthValidation(11, vm.ManagePurchaseForm.poQty.$viewValue.length)}}</span>
                            </div>
                            <div ng-message="min">
                              <span>{{vm.getMinNumberValueValidation(1)}}</span>
                            </div>
                            <div ng-message="step || number || max || valid">
                              <span>{{vm.CORE_MESSAGE_CONSTANT.INVALID}}</span>
                            </div>
                          </div>
                        </md-input-container>
                      </div>
                    </td>

                    <th colspan="2">
                      <p class="label-container">
                        {{vm.LabelConstant.Purchase.PricePerUnit}}<span>&nbsp;*</span>
                      </p>
                    </th>
                    <td colspan="3">
                      <div layout="row">
                        <md-input-container flex>
                          <input type="number" name="poPricePerUnit" min="{{$root.unitInputStep}}" step="{{$root.unitInputStep}}"
                                 ng-model="vm.purchase.poPricePerUnit"
                                 placeholder="{{vm.LabelConstant.Purchase.PricePerUnit}}"
                                 ng-change="vm.getExtendedPrice()"
                                 ng-required="true"
                                 ng-maxlength="17"
                                 max="9999999999">
                          <div ng-messages="vm.ManagePurchaseForm.poPricePerUnit.$error"
                               role="alert" ng-if="vm.ManagePurchaseForm.poPricePerUnit.$touched">
                            <div ng-message="required">
                              <span>{{vm.CORE_MESSAGE_CONSTANT.REQUIRED}}</span>
                            </div>
                            <div ng-message="maxlength">
                              <span>{{vm.getMaxLengthValidation(17, vm.ManagePurchaseForm.poPricePerUnit.$viewValue.length)}}</span>
                            </div>
                            <div ng-message="min">
                              <span>{{vm.getMinNumberValueValidation($root.unitInputStep)}}</span>
                            </div>
                            <div ng-message="step || number || max || valid">
                              <span>{{vm.CORE_MESSAGE_CONSTANT.INVALID}}</span>
                            </div>
                          </div>
                        </md-input-container>
                      </div>
                    </td>
                    <th colspan="2">
                      <p class="label-container">
                        {{vm.LabelConstant.Purchase.ExtendedPrice}}
                      </p>
                    </th>
                    <td colspan="3">
                      <div layout="row">
                        <md-input-container flex>
                          <input type="number" name="poExtendedPrice" step="0.01" input-number-decimal-place
                                 ng-model="vm.purchase.poExtendedPrice"
                                 placeholder="{{vm.LabelConstant.Purchase.ExtendedPrice}}"
                                 ng-disabled="true">
                        </md-input-container>
                      </div>
                    </td>
                  </tr>
                </table>
              </div>
            </div>
            <div class="cm-section-inner" flex="100" layout="row">
              <div flex="100">
                <table cellspacing="0" cellpadding="0" class="cm-table-input-main">
                  <tr>
                    <th colspan="2">
                      <p class="label-container">
                        Part Description
                      </p>
                    </th>
                    <td colspan="3">
                      <div layout="row">
                        <md-input-container flex>
                          <textarea type="text" name="selectedComponentMfgDescription" max-rows="2" rows="1" cols="350"
                                    ng-model="vm.selectedComponentMfgDescription" ng-required="false" ng-disabled="true"></textarea>
                        </md-input-container>
                      </div>
                    </td>
                    <th colspan="2"></th>
                    <td colspan="3"></td>
                    <th colspan="2"></th>
                    <td colspan="3">
                      <div layout="row" layout-align="end center">
                        <md-button class="md-primary md-raised" aria-label="receive" ng-click="vm.savePurchasePartsDetails()" id="btnSave"
                                   ng-disabled="!vm.ManagePurchaseForm.$valid || !vm.ManagePurchaseForm.$dirty">
                          {{(vm.purchase && vm.purchase.id)?'Update':'Add'}}
                        </md-button>
                        <md-button class="md-raised" aria-label="receive" ng-click="vm.resetPurchaseDetail()" id="btnResetDet">
                          Reset
                        </md-button>
                      </div>
                    </td>
                  </tr>
                </table>
              </div>
            </div>
          </div>
        </div>
        <div flex="100" layout="row" layout-wrap>
          <div ng-show="!vm.isNoDataFound" class="padding-10 ph-0-imp" flex="100">
            <md-card layout="column" class="margin-0" flex layout-align="space-between stretch">
              <ui-grid-extention class="cm-purchase-parts-detail-grid"
                                 load-data="vm.loadData"
                                 grid-option="vm.gridOptions"
                                 header="vm.sourceHeader"
                                 grid-data="vm.sourceData"
                                 total-data-count="vm.totalSourceDataCount"
                                 reset-grid="vm.resetSourceGrid"
                                 selectted-rows="vm.selectedRowsList"
                                 paging-info="vm.pagingInfo"
                                 current-item="vm.currentdata"
                                 get-data-down="vm.getDataDown"
                                 empty-state="vm.emptyState">
            </md-card>
          </div>
          <div class="empty-state text-center full-height" flex="100" layout="row" layout-align="center center" layout-wrap
               ng-show="vm.isNoDataFound">
            <div class="emty-icon" flex="100">
              <img ng-src="{{vm.EmptyMesssage.IMAGEURL}}" />
            </div>
            <p flex="100" class="empty-state-title">{{vm.EmptyMesssage.MESSAGE}}</p>
            <!--<p flex="100" ng-if="vm.isGridVisible">
              {{vm.EmptyMesssage.ADDNEWMESSAGE}}
            </p>-->
            <p flex="100">
              <md-button class="md-fab md-mini" aria-label="Refresh" ng-click="vm.loadData()">
                <md-icon role="img" md-font-icon="icon-refresh" class="material-icons mat-icon icon-plus"></md-icon>
                <md-tooltip md-direction="top">Refresh</md-tooltip>
              </md-button>
            </p>
          </div>
        </div>
      </md-content>
    </md-dialog-content>
    <md-dialog-actions layout="row">
      <md-button class="md-default md-raised" ng-click="vm.cancel()">Close</md-button>
    </md-dialog-actions>
  </form>
</md-dialog>
