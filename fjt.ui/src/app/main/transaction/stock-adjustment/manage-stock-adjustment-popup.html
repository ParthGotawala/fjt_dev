<md-dialog aria-label="Add stockAdjustment" class="stockadjustment-popup-width" cg-busy="{promise:vm.cgBusyLoading}" draggable>
  <form name="vm.stockAdjustmentForm">
    <md-toolbar>
      <div class="md-toolbar-tools" layout="row" layout-align="space-between center">
        <h2>{{vm.stockAdjustmentModel.ID ? 'Stock Adjustment Details' : 'Add Stock Adjustment'}}</h2>
        <span flex></span>
        <popup-header-label label-data="vm.headerdata"></popup-header-label>
        <md-button class="md-icon-button" ng-click="vm.cancel()">
          <md-icon role="img" md-font-icon="icon-close" class="material-icons mat-icon icon-close"></md-icon>
        </md-button>
      </div>
    </md-toolbar>
    <md-dialog-content class="customer-modal no-padding custom-scroll cm-custom-label-common">
      <md-content class="padding-10 mh-5">
        <div layout="row" layout-gt-xs="row" class="cm-section-main border-0 p-0-imp" flex="100">
          <div class="cm-section-inner flex-100 p-0-imp">
            <table cellspacing="0" cellpadding="0" class="cm-table-input-main cm-stock-adjustment-table-data">
              <tbody>
                <tr>
                  <!-- assy ID -->
                  <th>
                    <p class="label-container">
                      <a class="cm-text-decoration underline" ng-click="vm.goToPartList();"
                         tabindex="-1">{{vm.LabelConstant.Assembly.ID}}</a><span ng-if="!vm.stockAdjustmentModel.ID">&nbsp;*</span>
                    </p>
                  </th>
                  <td class="width-270">
                    <md-input-container ng-if="vm.autoCompleteAssy" class="autocompletecustom margin-bottom-0" flex="100">
                      <custom-auto-complete-search on-search-fn="vm.autoCompleteAssy.onSearchFn"
                                                   column-name="vm.autoCompleteAssy.columnName"
                                                   parent-column-name="vm.autoCompleteAssy.parentColumnName"
                                                   key-column-name="vm.autoCompleteAssy.keyColumnName"
                                                   input-name="vm.autoCompleteAssy.inputName"
                                                   placeholder-name="vm.autoCompleteAssy.placeholderName"
                                                   key-column-id="vm.autoCompleteAssy.keyColumnId"
                                                   is-required="true"
                                                   search-text="vm.autoCompleteAssy.searchText"
                                                   parent-id=""
                                                   on-select-callback-fn="vm.autoCompleteAssy.onSelectCallbackFn"
                                                   is-disabled="vm.stockAdjustmentModel.ID || vm.isDisableToAccess"
                                                   custom-auto-focus="{{vm.stockAdjustmentModel.ID ? false : true}}"
                                                   class="width-260">
                      </custom-auto-complete-search>
                    </md-input-container>
                  </td>
                  <!-- assy# -->
                  <th>
                    <p class="label-container">
                      <a class="cm-text-decoration underline" ng-click="vm.goToPartList();"
                         tabindex="-1">{{vm.LabelConstant.Assembly.MFGPN}}</a>
                    </p>
                  </th>
                  <td>
                    <p class="label-container">
                      <md-input-container flex="100" class="margin-bottom-0">
                        <input type="text" name="mfgPN" id="mfgPN" ng-model="vm.stockAdjustmentModel.mfgPN"
                               placeholder="Assy#" disabled>
                      </md-input-container>
                    </p>
                  </td>
                  <!-- nickname -->
                  <th>
                    <p class="label-container">
                      {{vm.LabelConstant.Assembly.NickName}}
                    </p>
                  </th>
                  <td>
                    <p class="label-container">
                      <md-input-container flex="100" class="margin-bottom-0">
                        <input type="text" name="nickname" id="nickname" ng-model="vm.stockAdjustmentModel.nickname"
                               placeholder="nickname" disabled>
                      </md-input-container>
                    </p>
                  </td>
                </tr>

                <tr>
                  <!-- Assy Description -->
                  <th>
                    <p class="label-container">
                      {{vm.LabelConstant.Assembly.Description}}
                    </p>
                  </th>
                  <td colspan="3">
                    <p class="label-container">
                      <md-input-container flex="100" class="margin-bottom-0">
                        <input type="text" name="mfgPNDescription" id="mfgPNDescription" ng-model="vm.stockAdjustmentModel.mfgPNDescription"
                               placeholder="Assy Description" disabled>
                      </md-input-container>
                    </p>
                  </td>
                  <!-- WO# -->
                  <th>
                    <p class="label-container">
                      <a class="cm-text-decoration underline" ng-click="vm.goToWorkorderList();" tabindex="-1">
                        {{vm.LabelConstant.Workorder.WO}}
                      </a><span ng-if="!vm.stockAdjustmentModel.ID && vm.autoCompleteAssy.keyColumnId ? true : false ">&nbsp;*</span>
                    </p>
                  </th>
                  <td>
                    <md-input-container ng-if="vm.autoCompleteWO" class="autocompletecustom margin-bottom-0" flex="100">
                      <custom-auto-complete datalist="vm.assyWOList"
                                            column-name="vm.autoCompleteWO.columnName"
                                            parent-column-name="vm.autoCompleteWO.parentColumnName"
                                            key-column-name="vm.autoCompleteWO.keyColumnName"
                                            input-name="vm.autoCompleteWO.inputName"
                                            placeholder-name="vm.autoCompleteWO.placeholderName"
                                            key-column-id="vm.autoCompleteWO.keyColumnId"
                                            is-required="vm.autoCompleteAssy.keyColumnId ? true : false"
                                            parent-id=""
                                            on-select-callback-fn="vm.autoCompleteWO.onSelectCallbackFn"
                                            is-disabled="vm.stockAdjustmentModel.ID || !vm.autoCompleteAssy.keyColumnId || vm.isDisableWO">
                      </custom-auto-complete>
                    </md-input-container>
                  </td>
                </tr>
                <tr>
                  <!-- Adjust Stock -->
                  <th>
                    <p class="label-container">
                      {{vm.LabelConstant.StockAdjustment.AdjustmentQty}}<span ng-if="!vm.isViewOnly">&nbsp;*</span><check-unique-on-blur></check-unique-on-blur>
                    </p>
                  </th>
                  <td>
                    <md-input-container flex="100" class="margin-bottom-0">
                      <input type="number" name="adjustmentQty" id="adjustmentQty" ng-model="vm.stockAdjustmentModel.openingStock"
                             placeholder="Adjustment Stock Qty" step="1" ng-min="-{{(vm.stockAdjustmentModel.woNumber && vm.stockAdjustmentModel.actualAvalilableQty) ? vm.stockAdjustmentModel.actualAvalilableQty : 0 }}" ng-max="999999999" required
                             custom-auto-focus="{{vm.stockAdjustmentModel.ID ? true : false}}"
                             custom-blur="vm.setCummulativeQty()" ng-disabled="vm.isViewOnly">
                      <span flex="100" class="font-size-10" ng-if="!vm.isViewOnly">
                        <b>Hint: To remove stock, enter negative(-) number</b>
                      </span>
                      <div ng-messages="vm.stockAdjustmentForm.adjustmentQty.$error"
                           role="alert">
                        <div ng-message="required">
                          <span>{{vm.CORE_MESSAGE_CONSTANT.REQUIRED}}</span>
                        </div>
                        <div ng-message="min">
                          <!--<span>{{ vm.CORE_MESSAGE_CONSTANT.DYNAMIC_MESSAGE.MFG.ADJUSTMENT_STOCK_INVALID_QTY.message }}</span>-->
                          <!-- <span>{{vm.LabelConstant.StockAdjustment.InvalidQty}}</span> -->
                          <span>Not allowed less than {{vm.stockAdjustmentModel.actualAvalilableQty || 0}}</span>
                        </div>
                        <div ng-message="step || number || min || max">
                          <span>{{vm.CORE_MESSAGE_CONSTANT.INVALID}}</span>
                        </div>
                      </div>
                    </md-input-container>
                  </td>
                  <!-- NOTES -->
                  <th>
                    <p class="label-container">
                      {{vm.LabelConstant.StockAdjustment.Notes}}
                    </p>
                  </th>
                  <!-- After Stock Adjustment View		 -->
                  <td colspan="3">
                    <md-input-container flex="100" class="margin-bottom-0">
                      <textarea name="stockAdjustmentNotes"
                                id="stockAdjustmentNotes"
                                typeof="text"
                                ng-model="vm.stockAdjustmentModel.serialNo"
                                rows="1" ng-maxlength="255" md-maxlength="255"
                                placeholder="Notes"
                                ng-disabled="vm.isViewOnly"></textarea>
                      <div ng-messages="vm.stockAdjustmentForm.stockAdjustmentNotes.$error" role="alert">
                        <div ng-message="maxlength">
                          <span>{{vm.getMaxLengthValidation(255, vm.stockAdjustmentForm.stockAdjustmentNotes.$viewValue.length)}}</span>
                        </div>
                      </div>
                    </md-input-container>
                  </td>
                </tr>
                <tr ng-if="vm.stockAdjustmentModel.partID && vm.stockAdjustmentModel.woNumber && !vm.isViewOnly">
                  <td></td>
                  <td colspan="4">
                    <div class="cm-section-main" flex="100">
                      <div class="cm-common-table-ui">
                        <table border="1" width="100%" class="padding-5 opration-table text-center cm-table-stock-adjustment">
                          <thead>
                            <tr>
                              <td colspan="4" class="padding-5">
                                Summary After Stock Adjustment
                              </td>
                            </tr>
                            <tr>
                              <td class="text-right padding-5 width-155">
                              </td>
                              <td class="text-right padding-5 border-0 display-flex" layout-align="end start">
                                Cumulative Assy Qty
                                <div class="icon-question-mark-circle help-icon">
                                  <md-tooltip md-direction="top">{{vm.LabelConstant.Workorder.WO}} {{vm.stockAdjustmentModel.woNumber}} Qty + Other WO Qty</md-tooltip>
                                </div>
                              </td>
                              <td class="text-right padding-5">
                                {{vm.LabelConstant.Workorder.WO}} {{vm.stockAdjustmentModel.woNumber}} Qty
                              </td>
                              <td class="text-right padding-5">
                                Other WO Qty
                              </td>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <th class="text-right padding-5-imp">
                                <span class="value">
                                  Current Stock
                                </span>
                              </th>
                              <td class="text-right padding-5">
                                <span class="value">
                                  {{vm.stockAdjustmentModel.cumulativeAssyStock}}
                                </span>
                              </td>
                              <td class="text-right padding-5">
                                <span class="value">
                                  {{vm.stockAdjustmentModel.availableQty}}
                                </span>
                              </td>
                              <td class="text-right padding-5">
                                <span class="value">
                                  <a class="underline cursor-pointer" ng-click="vm.ViewAssemblyStockStatus();"
                                     tabindex="-1">{{vm.stockAdjustmentModel.cumulativeAssyStock - vm.stockAdjustmentModel.availableQty}}</a>
                                </span>
                              </td>
                            </tr>
                            <tr class="font-weight-700 font-size-18">
                              <th class="text-right padding-5-imp">
                                <span class="value">
                                  {{vm.LabelConstant.StockAdjustment.AdjustmentQty}}
                                </span>
                              </th>
                              <td class="text-right padding-5">
                                <span class="value">
                                  <b class="font-size-18"> {{vm.stockAdjustmentModel.openingStock | numberWithoutDecimal}} </b>
                                </span>
                              </td>
                              <td class="text-right padding-5">
                                <span class="value">
                                  <b class="font-size-18">{{vm.stockAdjustmentModel.openingStock | numberWithoutDecimal}}</b>
                                </span>
                              </td>
                              <td class="text-right padding-5">
                                <span class="value">
                                  <b class="font-size-18">-</b>
                                </span>
                              </td>
                            </tr>
                          </tbody>
                          <tfoot>
                            <tr>
                              <td class="text-right padding-5">
                                After Adjustment
                              </td>
                              <td class="text-right padding-5">
                                <span class="value">
                                  {{ vm.cumulativeAssyStock }}
                                </span>
                              </td>
                              <td class="text-right padding-5">
                                <span class="value">
                                  {{ vm.stockAdjustmentModel.availableQty + vm.stockAdjustmentModel.openingStock }}
                                </span>
                              </td>
                              <td class="text-right padding-5">
                                <span class="value">
                                  {{ vm.aftAdjustOtherWOQty }}
                                </span>
                              </td>
                            </tr>
                          </tfoot>
                        </table>
                      </div>
                    </div>
                  </td>
                </tr>
                <!-- End After Stock Adjustment View		 -->
              </tbody>
            </table>
          </div>
        </div>
      </md-content>
    </md-dialog-content>
    <md-dialog-actions layout="row">
      <md-button class="md-default md-raised" ng-click="vm.cancel()">Cancel</md-button>
      <md-button class="md-primary md-raised" ng-if="!vm.isViewOnly" ng-click="vm.addUpdateStockAdjustment()" ng-class="{'md-formdirty': vm.stockAdjustmentForm.$dirty}" aria-label="Submit" ng-disabled="vm.isSubmit">Save</md-button>
    </md-dialog-actions>
  </form>
</md-dialog>
