<div id="forms" class="page-layout simple fullwidth doc-page breadcrumb-fixed cm-custom-label-common" layout="column" cg-busy="{promise:vm.cgBusyLoading}">
  <ms-form-wizard flex="100" layout="row">
    <div class="header md-accent-bg overflow-auto-rs" layout="row" flex="100">
      <div layout="row" layout-align="start center">
        <md-button class="goto-products-button md-icon-button cm-back-btn-p-m" type="button" aria-label="Go to Refund List" ng-click="vm.goBack(msWizard)">
          <md-icon md-font-icon="icons-backarrow" class="material-icons icons-backarrow cm-back-btn">
          </md-icon>
        </md-button>
        <div class="white-fg" layout="column" layout-align="start start">
          <div class="h2" layout="row" layout-align="start center">
            <pagetitle is-list="false" is-display-menu-name="true"
                       prefix-content="vm.id ? 'Update ' : 'Add '"
                       suffix-content="(vm.id && vm.displayRefundDetail.paymentNumber) ? ': ' + vm.displayRefundDetail.paymentNumber : ''">
            </pagetitle>
            <md-tooltip md-direction="right" ng-if="vm.id && vm.displayRefundDetail.paymentNumber">{{vm.displayRefundDetail.paymentNumber}}</md-tooltip>
          </div>
          <div layout="row" layout-align="start center">
            <breadcrumbs></breadcrumbs>
          </div>
        </div>
      </div>
      <div layout="row" layout-align="start center" flex="15">
        <div layout="column" flex="100" class="cm-header-search-add-container">
          <div ng-if="vm.autoCompletePaymentNumber">
            <md-input-container ng-if="vm.autoCompletePaymentNumber" class="width-100p autocompletecustom margin-0 widget-dashboard-search-area" flex="100" flex-gt-xs="100">
              <custom-auto-complete-search on-search-fn="vm.autoCompletePaymentNumber.onSearchFn"
                                           column-name="vm.autoCompletePaymentNumber.columnName"
                                           key-column-name="vm.autoCompletePaymentNumber.keyColumnName"
                                           key-column-id="vm.autoCompletePaymentNumber.keyColumnId"
                                           input-name="vm.autoCompletePaymentNumber.inputName"
                                           placeholder-name="vm.autoCompletePaymentNumber.placeholderName"
                                           is-required="vm.autoCompletePaymentNumber.isRequired"
                                           is-addnew="vm.autoCompletePaymentNumber.isAddnew"
                                           callback-fn="vm.autoCompletePaymentNumber.callbackFn"
                                           on-select-callback-fn="vm.autoCompletePaymentNumber.onSelectCallbackFn">
              </custom-auto-complete-search>
            </md-input-container>
          </div>
          <div class="cm-square-icon-btn pt-2">
            <md-button class="md-primary md-raised mv-0-imp ml-0 md-icon-button" ng-click="vm.addRefund(true);"
                       ng-if="vm.displayRefundDetail.id"
                       ng-disabled="vm.pageTabRights && vm.pageTabRights.length > 0 && vm.pageTabRights[0].DetailTab && (!vm.pageTabRights[0].DetailTab.hasPermission || vm.pageTabRights[0].DetailTab.isReadOnly)">
              <md-icon md-font-icon="t-icons-supplier-refund" class="add-icon icon"></md-icon>
              <md-tooltip>Add Refund In New Tab</md-tooltip>
            </md-button>
            <md-button class="md-primary md-raised mv-0-imp ml-0 md-icon-button" ng-click="vm.addRefund(false)"
                       ng-if="vm.displayRefundDetail.id"
                       ng-disabled="vm.pageTabRights && vm.pageTabRights.length > 0 && vm.pageTabRights[0].DetailTab && (!vm.pageTabRights[0].DetailTab.hasPermission || vm.pageTabRights[0].DetailTab.isReadOnly)">
              <md-icon md-font-icon="t-icons-supplier-refund" class="add-icon icon same-tab-icon"></md-icon>
              <md-tooltip>Add Refund</md-tooltip>
            </md-button>
          </div>
        </div>
      </div>

      <div layout="row" flex>
        <div layout="row" flex="100" layout-wrap>
          <div flex layout="row" layout-wrap>
            <div flex="100" layout-wrap>
              <table cellspacing="0" cellpadding="0" class="cm-header-data-table cm-supplier-refund-header-table relative width-auto">
                <tbody>
                  <tr>
                    <th>
                      <a class="cursor-pointer text-underline" ng-click="vm.goToSupplierList();">
                        Supplier:
                      </a>
                    </th>
                    <td class="pr-10 min-width-40">
                      <span class="cm-name text-underline cursor-pointer" ng-click="vm.goToSupplierDetail()">
                        <md-tooltip class="tt-multiline cm-white-space-normal max-width-420 pv-5"
                                    ng-if="vm.displayRefundDetail.mfgName">
                          {{vm.displayRefundDetail.mfgName}}
                        </md-tooltip>
                        <b>{{vm.displayRefundDetail.mfgName}}</b>
                      </span>
                    </td>
                    <th>Payment# or Check#:</th>
                    <td class="min-width-40">
                      <span class="cm-data">
                        <md-tooltip ng-if="vm.displayRefundDetail.paymentNumber">
                          {{vm.displayRefundDetail.paymentNumber}}
                        </md-tooltip>
                        <b>
                          {{vm.displayRefundDetail.paymentNumber}}
                        </b>
                      </span>
                      <copy-text ng-if="vm.displayRefundDetail.paymentNumber" label="vm.CORE.LabelConstant.SalesOrder.SO"
                                 text="vm.displayRefundDetail.paymentNumber"></copy-text>
                    </td>
                  </tr>
                  <tr>
                    <th>
                      <a class="cursor-pointer text-underline" ng-click="vm.goToTransactionModeList();">
                        Transaction Mode:
                      </a>
                    </th>
                    <td class="pr-10 min-width-40">
                      <span class="cm-name text-underline cursor-pointer" ng-click="vm.goToTransactionModeDetail()">
                        <md-tooltip class="tt-multiline cm-white-space-normal max-width-420 pv-5"
                                    ng-if="vm.displayRefundDetail.transactionModeName">
                          {{vm.displayRefundDetail.transactionModeName}}
                        </md-tooltip>
                        <b>{{vm.displayRefundDetail.transactionModeName}}</b>
                      </span>
                    </td>
                    <th>Refund Date:</th>
                    <td class="min-width-40">
                      <span class="cm-date">
                        <b>{{vm.displayRefundDetail.paymentDate | date: vm.DefaultDateFormat}}</b>
                      </span>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div layout="row" layout-align="end center" class="cm-square-icon-btn">
        <div class="text-align-center pr-5"
             ng-if="vm.lockStatus === vm.TRANSACTION.CustomerPaymentLockStatus.Locked"
             ng-class="{'pb-10': !vm.allowToVoidAndReIssuePaymentFeature}">
          <span class="label-box font-weight-500 font-size-13 label-danger">
            Locked
            <md-tooltip md-direction="bottom" class="tt-multiline">
              Locked By: {{vm.lockByName}} <br />
              Locked Date: {{vm.lockedAt}}
            </md-tooltip>
          </span>
        </div>
        <div layout="row" class="mr-8" ng-class="{'pb-10': !vm.allowToVoidAndReIssuePaymentFeature}">
          <div layout="row" flex="100">
            <div class="text-align-center cm-payment-status-header pr-5" ng-if="vm.id">
              <span class="font-weight-500 font-size-13 margin-left-4 color-black">Refund Status: </span>
              <span class="label-box font-weight-500 font-size-13 cm-payment-status-text"
                    ng-class="{'label-success': !vm.displayRefundDetail.isPaymentVoided,
                'label-warning': vm.displayRefundDetail.isPaymentVoided}">
                {{vm.displayRefundDetail.isPaymentVoided ? 'Voided' : 'Paid'}}
              </span>
            </div>
          </div>
        </div>
        <div layout="row" ng-if="vm.IsDetailTab">
          <div layout="column">
            <div layout="row" flex="100">
              <div layout="row" flex="100">
                <md-button class="md-raised md-primary margin-left-0 cm-feture-btn-color"
                           ng-click="vm.voidAndReIssueRefundTransaction($event);"
                           ng-disabled="!vm.id || vm.displayRefundDetail.isPaymentVoided || vm.saveBtnDisableFlag || !vm.allowToVoidAndReIssuePaymentFeature || vm.supplierRefundDetailForm.$dirty || vm.isRefundLocked || (vm.pageTabRights && vm.pageTabRights.length > 0 && vm.pageTabRights[0].DetailTab && vm.pageTabRights[0].DetailTab.isReadOnly)">
                  Void & Reissue Refund
                </md-button>
              </div>
              <div layout="row" flex="100">
                <md-button class="md-raised md-primary margin-left-0 cm-feture-btn-color mr-0"
                           ng-click="vm.voidRefundTransaction();"
                           ng-disabled="!vm.id || vm.displayRefundDetail.isPaymentVoided || vm.saveBtnDisableFlag || !vm.allowToVoidAndReIssuePaymentFeature || vm.supplierRefundDetailForm.$dirty || vm.isRefundLocked || (vm.pageTabRights && vm.pageTabRights.length > 0 && vm.pageTabRights[0].DetailTab && vm.pageTabRights[0].DetailTab.isReadOnly)">
                  Void Refund
                </md-button>
              </div>
            </div>
            <div layout="row" flex="100">
              <span class="font-weight-600 font-size-10" ng-if="!vm.allowToVoidAndReIssuePaymentFeature">
                Allow feature to enable Void Refund feature.
              </span>
            </div>
          </div>
        </div>
        <div layout="row" ng-if="vm.IsDetailTab" class="cm-btn-group">
          <md-button class="md-icon-button md-primary md-raised md-mini" ng-click="vm.paymentHistory($event)" ng-disabled="!vm.id">
            <md-icon md-font-icon="t-icons-history-text" class="material-icons"></md-icon>
            <md-tooltip>Refund History</md-tooltip>
          </md-button>
          <md-button class="md-raised md-primary"
                     ng-class="{'md-formdirty': vm.supplierRefundDetailForm.$dirty, 'pb-10': !vm.allowToVoidAndReIssuePaymentFeature}"
                     ng-click="vm.saveDetails();" id="saveBtn"
                     ng-disabled="vm.saveBtnDisableFlag || vm.displayRefundDetail.isPaymentVoided || vm.isRefundLocked || (vm.pageTabRights && vm.pageTabRights.length > 0 && vm.pageTabRights[0].DetailTab && vm.pageTabRights[0].DetailTab.isReadOnly)">
            Save
          </md-button>
        </div>
      </div>
    </div>
    <!-- / CONTENT HEADER -->
    <div class="content-card padding-top-60" layout="column" flex="100">
      <div layout="row" flex="100">
        <div flex>
          <md-tabs validate-step="true" is-valid="vm.isStepValid" class="fielddetail manage-customer-tabing padding-0 cm-part-tab cm-part-tab-scroll cm-manage-com-doc" md-dynamic-height md-selected="vm.selectedTabIndex" id="manage-customer-tabing">
            <!--Detail-->
            <md-tab md-on-select="vm.onTabChanges(vm.supplierInvoiceRefundTabs.Detail.Name, msWizard)" ng-disabled="!vm.pageTabRights[0].DetailTab.hasPermission">
              <md-tab-label>
                <span class="ms-form-wizard-step-label">
                  <span class="ms-form-wizard-step-number md-accent-bg">0</span>
                  <span class="ms-form-wizard-step-number md-accent-bg">
                    <i class="icon-check s16"></i>
                  </span>
                  <span ng-class="{'disabled-mdtab': (!vm.id || !vm.pageTabRights[0].DetailTab.hasPermission)}" class="ms-form-wizard-step-text">Details</span>
                </span>
              </md-tab-label>
              <md-tab-body>
                <div layout="column" layout-gt-xs="100" ng-if="vm.IsDetailTab">
                  <supplier-invoice-refund-detail payment-id="vm.id"
                                                  save-btn-disable-flag="vm.saveBtnDisableFlag"
                                                  cg-busy-loading="vm.cgBusyLoading"
                                                  display-refund-detail="vm.displayRefundDetail"
                                                  is-refund-locked="vm.isRefundLocked"
                                                  lock-status="vm.lockStatus"
                                                  lock-by-name="vm.lockByName"
                                                  locked-at="vm.lockedAt"
                                                  state-param-mfg-code-id="vm.stateParamMfgCodeId"
                                                  state-param-memo-id="vm.stateParamMemoId">
                  </supplier-invoice-refund-detail>
                </div>
              </md-tab-body>
            </md-tab>

            <!--Document-->
            <md-tab ng-disabled="!vm.id || !vm.pageTabRights[0].DocumentTab.hasPermission" md-on-select="vm.onTabChanges(vm.supplierInvoiceRefundTabs.Document.Name,msWizard)">
              <md-tab-label>
                <span class="ms-form-wizard-step-label">
                  <span class="ms-form-wizard-step-number md-accent-bg"
                        ng-if="!vm.id">1</span>
                  <span class="ms-form-wizard-step-number md-accent-bg" ng-if="vm.id">
                    <i class="icon-check s16"></i>
                  </span>
                  <span ng-class="{'disabled-mdtab': (!vm.id || !vm.pageTabRights[0].DocumentTab.hasPermission)}" class="ms-form-wizard-step-text">Documents <b>({{(vm.documentCount)}})</b></span>
                </span>
              </md-tab-label>
              <md-tab-body>
                <div ng-if="vm.IsDocumentTab && vm.displayRefundDetail.id" class="cm-type-document-scroll pl-5 pr-5">
                  <documents entity="vm.entityName" ref-trans-id="vm.id" is-title="null"
                             is-hide-display-tree="true" is-protected="vm.isRefundLocked || (vm.pageTabRights && vm.pageTabRights.length > 0 && vm.pageTabRights[0].DocumentTab && vm.pageTabRights[0].DocumentTab.isReadOnly)"> </documents>
                </div>
              </md-tab-body>
            </md-tab>

          </md-tabs>
        </div>
      </div>
    </div>
  </ms-form-wizard>
</div>
